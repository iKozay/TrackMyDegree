{"version":3,"file":"exemption.js","sourceRoot":"","sources":["../../routes/exemption.ts"],"names":[],"mappings":"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","sourcesContent":["import HTTP from '@Util/HTTPCodes';\nimport express, { Request, Response } from 'express';\nimport exemptionController from '@controllers/exemptionController/exemptionController';\n\nconst router = express.Router();\n\nrouter.post('/create', async (req: Request, res: Response) => {\n  const { coursecodes, user_id } = req.body;\n\n  try {\n    // Validate input\n    if (\n      !Array.isArray(coursecodes) ||\n      coursecodes.some((cc) => typeof cc !== 'string') ||\n      typeof user_id !== 'string'\n    ) {\n      res.status(HTTP.BAD_REQUEST).json({\n        error:\n          'Invalid input. Please provide an array of course codes and a user_id as a string.',\n      });\n      return;\n    }\n\n    // Call the service function\n    const result = await exemptionController.createExemptions(\n      coursecodes,\n      user_id,\n    );\n\n    // Compose a success message\n    let message = 'Exemptions created successfully.';\n    if (result.alreadyExists.length > 0) {\n      message += ` Exemptions for the following course codes already existed: ${result.alreadyExists.join(', ')}.`;\n    }\n\n    // Send success response\n    res.status(HTTP.CREATED).json({\n      message,\n      exemptions: result.created,\n    });\n  } catch (error) {\n    // Handle errors from the service\n    if (error instanceof Error) {\n      console.error('ERROR: ', error.message);\n      res.status(HTTP.FORBIDDEN).json({ error: error.message });\n    } else {\n      const errMsg = 'Internal server error in /exemption/create';\n      console.error(errMsg, error);\n      res.status(HTTP.SERVER_ERR).json({ error: errMsg });\n    }\n  }\n});\n\nrouter.post('/getAll', async (req: Request, res: Response) => {\n  const { user_id } = req.body;\n\n  try {\n    // Validate input\n    if (!user_id || typeof user_id !== 'string') {\n      res.status(HTTP.BAD_REQUEST).json({\n        error: 'Invalid input. Please provide user_id as a string.',\n      });\n      return;\n    }\n\n    // Call the service function\n    const newExemption =\n      await exemptionController.getAllExemptionsByUser(user_id);\n\n    // Send success response\n    res.status(HTTP.OK).json({\n      message: 'Exemption read successfully.',\n      exemption: newExemption,\n    });\n  } catch (error) {\n    // Handle errors from the service\n    if (error instanceof Error) {\n      res.status(HTTP.FORBIDDEN).json({ error: error.message });\n    } else {\n      const errMsg = 'Internal server error in /exemption/getAll';\n      console.error(errMsg, error);\n      res.status(HTTP.SERVER_ERR).json({ error: errMsg });\n    }\n  }\n});\n\nrouter.post('/delete', async (req: Request, res: Response) => {\n  const { coursecode, user_id } = req.body;\n\n  try {\n    // Validate input\n    if (\n      !coursecode ||\n      typeof coursecode !== 'string' ||\n      !user_id ||\n      typeof user_id !== 'string'\n    ) {\n      res.status(HTTP.BAD_REQUEST).json({\n        error:\n          'Invalid input. Please provide coursecode and user_id as strings.',\n      });\n      return;\n    }\n\n    // Call the service function\n    await exemptionController.deleteExemptionByCoursecodeAndUserId(\n      coursecode,\n      user_id,\n    );\n\n    // Send success response\n    res.status(HTTP.OK).json({\n      message: 'Exemption deleted successfully.',\n    });\n  } catch (error) {\n    // Handle errors from the service\n    if (error instanceof Error) {\n      res.status(HTTP.FORBIDDEN).json({ error: error.message });\n    } else {\n      const errMsg = 'Internal server error in /exemption/delete';\n      console.error(errMsg, error);\n      res.status(HTTP.SERVER_ERR).json({ error: errMsg });\n    }\n  }\n});\n\nexport default router;\n"]}