{"version":3,"file":"sectionController.js","sourceRoot":"","sources":["../../../controllers/sectionController/sectionController.ts"],"names":[],"mappings":";AAAA,sFAAsF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEtF,kDAA0B;AAC1B,qDAAuC;AAEvC,MAAM,QAAQ,GAAG,6DAA6D,CAAC;AAE/E,sBAAsB;AACtB,mGAAmG;AACnG,KAAK,UAAU,iBAAiB,CAAC,OAAe,EAAE,OAAe;IAC/D,IAAI,CAAC;QACH,oFAAoF;QACpF,wEAAwE;QACxE,MAAM,UAAU,GACd,QAAQ;YACR,MAAM,CAAC,IAAI,CACT,GAAG,OAAO,CAAC,GAAG,CAAC,aAAa,IAAI,OAAO,CAAC,GAAG,CAAC,aAAa,EAAE,CAC5D,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;QAEvB,sEAAsE;QACtE,mEAAmE;QACnE,MAAM,QAAQ,GAAG,MAAM,eAAK,CAAC,GAAG,CAC9B,iEAAiE,OAAO,IAAI,OAAO,EAAE,EACrF;YACE,OAAO,EAAE;gBACP,aAAa,EAAE,UAAU;gBACzB,MAAM,EAAE,kBAAkB;aAC3B;SACF,CACF,CAAC;QAEF,8DAA8D;QAC9D,OAAO,QAAQ,CAAC;IAClB,CAAC;IAAC,OAAO,KAAK,EAAE,CAAC;QACf,kDAAkD;QAClD,MAAM,CAAC,gBAAgB,CAAC,KAAK,CAAC,CAAC;QAE/B,6BAA6B;QAC7B,IAAI,eAAK,CAAC,YAAY,CAAC,KAAK,CAAC,EAAE,CAAC;YAC9B,8EAA8E;YAC9E,OAAO,CAAC,KAAK,CAAC,qBAAqB,EAAE;gBACnC,MAAM,EAAE,KAAK,CAAC,QAAQ,EAAE,MAAM;gBAC9B,IAAI,EAAE,KAAK,CAAC,QAAQ,EAAE,IAAI;gBAC1B,OAAO,EAAE,KAAK,CAAC,QAAQ,EAAE,OAAO;aACjC,CAAC,CAAC;QACL,CAAC;QAED,2EAA2E;QAC3E,MAAM,IAAI,KAAK,CAAC,kCAAkC,CAAC,CAAC;IACtD,CAAC;AACH,CAAC;AAED,8DAA8D;AAC9D,MAAM,gBAAgB,GAAG;IACvB,iBAAiB;CAClB,CAAC;AAEF,kBAAe,gBAAgB,CAAC","sourcesContent":["// Controller responsible for fetching course schedules from Concordia's Open Data API\n\nimport axios from 'axios';\nimport * as Sentry from '@sentry/node';\n\nconst API_BASE = 'https://opendata.concordia.ca/API/v1/course/schedule/filter';\n\n// courseController.ts\n// Fetch the schedule of a specific course (based on subject + catalog number) from Concordia's API\nasync function getCourseSchedule(subject: string, catalog: string) {\n  try {\n    // Build the authentication header using credentials stored in environment variables\n    // The API requires Basic Auth, so we encode username:password as base64\n    const authHeader =\n      'Basic ' +\n      Buffer.from(\n        `${process.env.SCHEDULE_USER}:${process.env.SCHEDULE_PASS}`,\n      ).toString('base64');\n\n    // Send GET request to Concordia's schedule API with subject + catalog\n    // Example: subject = COMP, catalog = 674 â†’ fetch COMP 674 schedule\n    const response = await axios.get(\n      `https://opendata.concordia.ca/API/v1/course/schedule/filter/*/${subject}/${catalog}`,\n      {\n        headers: {\n          Authorization: authHeader,\n          Accept: 'application/json',\n        },\n      },\n    );\n\n    // Return the raw API response so it can be used by the caller\n    return response;\n  } catch (error) {\n    // Log the error to Sentry for monitoring/alerting\n    Sentry.captureException(error);\n\n    // Add detailed error logging\n    if (axios.isAxiosError(error)) {\n      // If it's an Axios-specific error, log extra details about the failed request\n      console.error('External API Error:', {\n        status: error.response?.status,\n        data: error.response?.data,\n        headers: error.response?.headers,\n      });\n    }\n\n    // Rethrow a simplified error so the caller knows the schedule fetch failed\n    throw new Error(`Failed to fetch course schedule.`);\n  }\n}\n\n// Group the controller methods under one object for exporting\nconst courseController = {\n  getCourseSchedule,\n};\n\nexport default courseController;\n"]}