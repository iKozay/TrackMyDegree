{"version":3,"file":"feedbackController.js","sourceRoot":"","sources":["../../../controllers/feedbackController/feedbackController.ts"],"names":[],"mappings":";AAAA;;;;;;;;GAQG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgBH,iCAmCC;AAjDD,gFAA8D;AAC9D,mCAAoC;AACpC,qDAAuC;AAEvC;;;;;;;;;GASG;AACY,KAAK,UAAU,cAAc,CAC1C,OAAe,EACf,OAAgB;IAEhB,MAAM,IAAI,GAAG,MAAM,sBAAQ,CAAC,aAAa,EAAE,CAAC;IAE5C,IAAI,IAAI,EAAE,CAAC;QACT,IAAI,CAAC;YACH,wDAAwD;YACxD,MAAM,EAAE,GAAG,IAAA,mBAAU,GAAE,CAAC;YAExB,+DAA+D;YAC/D,MAAM,YAAY,GAAG,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE,CAAC;YAE9C,iDAAiD;YACjD,mDAAmD;YACnD,MAAM,IAAI;iBACP,OAAO,EAAE;iBACT,KAAK,CAAC,IAAI,EAAE,sBAAQ,CAAC,KAAK,CAAC,OAAO,EAAE,EAAE,CAAC;iBACvC,KAAK,CAAC,SAAS,EAAE,sBAAQ,CAAC,KAAK,CAAC,OAAO,EAAE,OAAO,CAAC;iBACjD,KAAK,CAAC,SAAS,EAAE,sBAAQ,CAAC,KAAK,CAAC,OAAO,EAAE,OAAO,IAAI,IAAI,CAAC;iBACzD,KAAK,CAAC,cAAc,EAAE,sBAAQ,CAAC,KAAK,CAAC,SAAS,EAAE,YAAY,CAAC;iBAC7D,KAAK,CACJ,2GAA2G,CAC5G,CAAC;YAEJ,+EAA+E;YAC/E,OAAO,EAAE,EAAE,EAAE,OAAO,EAAE,OAAO,EAAE,YAAY,EAAE,CAAC;QAChD,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,MAAM,CAAC,gBAAgB,CAAC,KAAK,CAAC,CAAC;YAC/B,MAAM,KAAK,CAAC;QACd,CAAC;gBAAS,CAAC;YACT,IAAI,CAAC,KAAK,EAAE,CAAC;QACf,CAAC;IACH,CAAC;AACH,CAAC","sourcesContent":["/**\n * Purpose:\n *  - Controller module for the Feedback table.\n *  - Provides a function to submit feedback from users.\n * Notes:\n *  - Stores optional user_id if provided.\n *  - Errors are logged to Sentry and then rethrown.\n *  - Generates unique ID and timestamp for each feedback.\n */\n\nimport Database from '@controllers/DBController/DBController';\nimport { randomUUID } from 'crypto';\nimport * as Sentry from '@sentry/node';\n\n/**\n * Submits feedback to the database.\n * Feedback can optionally be tied to a specific user.\n *\n * @param {string} message - The feedback message provided by the user.\n * @param {string} [user_id] - The optional user ID associated with the feedback. If not provided, it's set to null.\n * @returns {Promise<{ id: string; message: string; user_id: string | null; submitted_at: string }>} - An object containing the feedback details: id, message, user_id, and timestamp when it was submitted.\n *\n * @throws {Error} - Throws an error if there's any issue while interacting with the database.\n */\nexport default async function submitFeedback(\n  message: string,\n  user_id?: string,\n) {\n  const conn = await Database.getConnection();\n\n  if (conn) {\n    try {\n      // Step 1: Generate a unique ID for this feedback entry.\n      const id = randomUUID();\n\n      // Step 2: Record the exact submission timestamp in ISO format.\n      const submitted_at = new Date().toISOString();\n\n      // Step 3: Insert the feedback into the database.\n      // If user_id is not provided, we store it as NULL.\n      await conn\n        .request()\n        .input('id', Database.msSQL.VarChar, id)\n        .input('message', Database.msSQL.VarChar, message)\n        .input('user_id', Database.msSQL.VarChar, user_id || null)\n        .input('submitted_at', Database.msSQL.DateTime2, submitted_at)\n        .query(\n          'INSERT INTO Feedback (id, message, user_id, submitted_at) VALUES (@id, @message, @user_id, @submitted_at)',\n        );\n\n      // Step 4: Return the full feedback object so the caller knows what was stored.\n      return { id, message, user_id, submitted_at };\n    } catch (error) {\n      Sentry.captureException(error);\n      throw error;\n    } finally {\n      conn.close();\n    }\n  }\n}\n"]}