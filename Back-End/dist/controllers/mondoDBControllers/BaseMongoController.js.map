{"version":3,"file":"BaseMongoController.js","sourceRoot":"","sources":["../../../controllers/mondoDBControllers/BaseMongoController.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Generic Base MongoDB Controller\n *\n * Provides optimized CRUD operations and utilities for all MongoDB controllers.\n */\n\nimport { Document, Model, FilterQuery, UpdateQuery } from 'mongoose';\nimport * as Sentry from '@sentry/node';\n\nconst QUERY_FAILED = 'Query failed';\nconst DELETE_FAILED = 'Delete failed';\n\nexport interface BaseDocument extends Document {\n  _id: string;\n}\n\nexport interface ControllerResponse<T> {\n  success: boolean;\n  data?: T;\n  error?: string;\n  message?: string;\n}\n\nexport interface PaginationOptions {\n  page?: number;\n  limit?: number;\n  sort?: Record<string, 1 | -1>;\n}\n\nexport interface SearchOptions {\n  search?: string;\n  fields?: string[];\n}\n\nexport interface QueryOptions extends PaginationOptions, SearchOptions {\n  /** Fields to select/project from the query */\n  select?: string | string[];\n}\n\n/**\n * Generic base controller class for MongoDB operations\n */\nexport abstract class BaseMongoController<T extends BaseDocument> {\n  protected model: Model<T>;\n  protected modelName: string;\n\n  constructor(model: Model<T>, modelName: string) {\n    this.model = model;\n    this.modelName = modelName;\n  }\n\n  /**\n   * Generic error handler with Sentry integration\n   */\n  protected handleError(error: unknown, operation: string): never {\n    Sentry.captureException(error, {\n      tags: {\n        model: this.modelName,\n        operation,\n      },\n    });\n    const errorMessage = error instanceof Error ? error.message : String(error);\n    console.error(`[${this.modelName}] Error in ${operation}:`, errorMessage);\n    throw error;\n  }\n\n  /**\n   * Create a new document\n   */\n  async create(data: Partial<T>): Promise<ControllerResponse<T>> {\n    try {\n      const document = await this.model.create(data);\n\n      return {\n        success: true,\n        data: document.toObject() as T,\n        message: `${this.modelName} created successfully`,\n      };\n    } catch (error) {\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : 'Creation failed',\n      };\n    }\n  }\n\n  /**\n   * Find document by ID with optional field selection\n   */\n  async findById(\n    id: string,\n    select?: string | string[],\n  ): Promise<ControllerResponse<T>> {\n    try {\n      let query = this.model.findById(id);\n\n      if (select) {\n        query = query.select(select);\n      }\n\n      const document = await query.lean<T>().exec();\n\n      if (!document) {\n        return { success: false, error: `${this.modelName} not found` };\n      }\n\n      return { success: true, data: document };\n    } catch (error) {\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : QUERY_FAILED,\n      };\n    }\n  }\n\n  /**\n   * Find document by custom filter\n   */\n  async findOne(\n    filter: FilterQuery<T>,\n    select?: string | string[],\n  ): Promise<ControllerResponse<T>> {\n    try {\n      let query = this.model.findOne(filter);\n\n      if (select) {\n        query = query.select(select);\n      }\n\n      const document = await query.lean<T>().exec();\n\n      if (!document) {\n        return { success: false, error: `${this.modelName} not found` };\n      }\n\n      return { success: true, data: document };\n    } catch (error) {\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : QUERY_FAILED,\n      };\n    }\n  }\n\n  /**\n   * Find all documents with optional filtering, search, and pagination\n   * Optimized with lean() and proper indexing\n   */\n  async findAll(\n    filter: FilterQuery<T> = {},\n    options: QueryOptions = {},\n  ): Promise<ControllerResponse<T[]>> {\n    try {\n      let query = this.model.find(filter);\n\n      // Apply search if provided\n      if (options.search && options.fields && options.fields.length > 0) {\n        const searchRegex = new RegExp(options.search, 'i');\n        const searchConditions = options.fields.map((field) => ({\n          [field]: searchRegex,\n        }));\n        query = query.or(searchConditions as FilterQuery<T>[]);\n      }\n\n      // Apply field selection\n      if (options.select) {\n        query = query.select(options.select);\n      }\n\n      // Apply sorting\n      if (options.sort) {\n        query = query.sort(options.sort);\n      }\n\n      // Apply pagination\n      if (options.page && options.limit) {\n        const skip = (options.page - 1) * options.limit;\n        query = query.skip(skip).limit(options.limit);\n      }\n\n      const documents = await query.lean<T[]>().exec();\n\n      return { success: true, data: documents };\n    } catch (error) {\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : QUERY_FAILED,\n      };\n    }\n  }\n\n  /**\n   * Update document by ID\n   */\n  async updateById(\n    id: string,\n    update: UpdateQuery<T>,\n  ): Promise<ControllerResponse<T>> {\n    try {\n      const document = await this.model\n        .findByIdAndUpdate(id, update, {\n          new: true,\n          runValidators: true,\n        })\n        .lean<T>()\n        .exec();\n\n      if (!document) {\n        return { success: false, error: `${this.modelName} not found` };\n      }\n\n      return {\n        success: true,\n        data: document,\n        message: `${this.modelName} updated successfully`,\n      };\n    } catch (error) {\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : 'Update failed',\n      };\n    }\n  }\n\n  /**\n   * Update document by custom filter\n   */\n  async updateOne(\n    filter: FilterQuery<T>,\n    update: UpdateQuery<T>,\n  ): Promise<ControllerResponse<T>> {\n    try {\n      const document = await this.model\n        .findOneAndUpdate(filter, update, {\n          new: true,\n          runValidators: true,\n          upsert: false,\n        })\n        .lean<T>()\n        .exec();\n\n      if (!document) {\n        return { success: false, error: `${this.modelName} not found` };\n      }\n\n      return {\n        success: true,\n        data: document,\n        message: `${this.modelName} updated successfully`,\n      };\n    } catch (error) {\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : 'Update failed',\n      };\n    }\n  }\n\n  /**\n   * Update or create document (upsert)\n   */\n  async upsert(\n    filter: FilterQuery<T>,\n    update: UpdateQuery<T>,\n  ): Promise<ControllerResponse<T>> {\n    try {\n      const document = await this.model\n        .findOneAndUpdate(filter, update, {\n          new: true,\n          upsert: true,\n          runValidators: true,\n        })\n        .lean<T>()\n        .exec();\n\n      return {\n        success: true,\n        data: document!,\n        message: `${this.modelName} saved successfully`,\n      };\n    } catch (error) {\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : 'Upsert failed',\n      };\n    }\n  }\n\n  /**\n   * Delete document by ID\n   */\n  async deleteById(id: string): Promise<ControllerResponse<string>> {\n    try {\n      const document = await this.model.findByIdAndDelete(id).exec();\n\n      if (!document) {\n        return { success: false, error: `${this.modelName} not found` };\n      }\n\n      return {\n        success: true,\n        message: `${this.modelName} deleted successfully`,\n      };\n    } catch (error) {\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : DELETE_FAILED,\n      };\n    }\n  }\n\n  /**\n   * Delete document by custom filter\n   */\n  async deleteOne(filter: FilterQuery<T>): Promise<ControllerResponse<string>> {\n    try {\n      const document = await this.model.findOneAndDelete(filter).exec();\n\n      if (!document) {\n        return { success: false, error: `${this.modelName} not found` };\n      }\n\n      return {\n        success: true,\n        message: `${this.modelName} deleted successfully`,\n      };\n    } catch (error) {\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : DELETE_FAILED,\n      };\n    }\n  }\n\n  /**\n   * Delete multiple documents\n   */\n  async deleteMany(\n    filter: FilterQuery<T>,\n  ): Promise<ControllerResponse<number>> {\n    try {\n      const result = await this.model.deleteMany(filter).exec();\n\n      return {\n        success: true,\n        data: result.deletedCount,\n        message: `${result.deletedCount} ${this.modelName}(s) deleted successfully`,\n      };\n    } catch (error) {\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : DELETE_FAILED,\n      };\n    }\n  }\n\n  /**\n   * Count documents with optional filter\n   * Uses countDocuments (not deprecated count method)\n   */\n  async count(\n    filter: FilterQuery<T> = {},\n  ): Promise<ControllerResponse<number>> {\n    try {\n      const count = await this.model.countDocuments(filter).exec();\n\n      return { success: true, data: count };\n    } catch (error) {\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : 'Count failed',\n      };\n    }\n  }\n\n  /**\n   * Check if document exists (optimized - only checks _id field)\n   */\n  async exists(filter: FilterQuery<T>): Promise<ControllerResponse<boolean>> {\n    try {\n      const exists = await this.model.exists(filter).exec();\n\n      return { success: true, data: !!exists };\n    } catch (error) {\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : 'Exists check failed',\n      };\n    }\n  }\n\n  /**\n   * Bulk create documents\n   */\n  async bulkCreate(documents: Partial<T>[]): Promise<ControllerResponse<T[]>> {\n    try {\n      const created = await this.model.insertMany(documents, {\n        ordered: false,\n        rawResult: false,\n      });\n\n      return {\n        success: true,\n        data: created.map((doc) => doc.toObject()) as T[],\n        message: `${created.length} ${this.modelName}(s) created successfully`,\n      };\n    } catch (error) {\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : 'Bulk create failed',\n      };\n    }\n  }\n\n  /**\n   * Aggregate query helper\n   */\n  async aggregate<R = unknown>(\n    pipeline: Record<string, unknown>[],\n  ): Promise<ControllerResponse<R[]>> {\n    try {\n      // Type assertion needed for flexibility with aggregation pipelines\n      const results = await this.model.aggregate<R>(pipeline as any[]).exec();\n\n      return { success: true, data: results };\n    } catch (error) {\n      return {\n        success: false,\n        error: error instanceof Error ? error.message : 'Aggregation failed',\n      };\n    }\n  }\n}\n"]}