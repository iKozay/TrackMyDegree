{"version":3,"file":"UserController.js","sourceRoot":"","sources":["../../../controllers/mondoDBControllers/UserController.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Provides user-specific operations including deficiencies and exemptions.\n */\n\nimport mongoose from 'mongoose';\nimport { BaseMongoController } from './BaseMongoController';\nimport { User, Course, Degree, Timeline } from '../../models';\n\nconst USER_WITH_ID_DOES_NOT_EXIST = 'User with this id does not exist.';\nconst USER_DOES_NOT_EXIST = 'User does not exist.';\n\nexport interface UserData {\n  _id: string;\n  email: string;\n  password?: string;\n  fullname: string;\n  degree?: string;\n  type: 'student' | 'advisor' | 'admin';\n  deficiencies?: Array<{ coursepool: string; creditsRequired: number }>;\n  exemptions?: string[];\n}\n\nexport interface DeficiencyData {\n  coursepool: string;\n  user_id: string;\n  creditsRequired: number;\n}\n\nexport interface ExemptionData {\n  coursecode: string;\n  user_id: string;\n}\n\nexport interface UserDataResponse {\n  user: {\n    _id: string;\n    email: string;\n    fullname: string;\n    type: string;\n    degree: string | null;\n  };\n  timeline: Array<{ season: string; year: number; coursecode: string }>;\n  deficiencies: Array<{ coursepool: string; creditsRequired: number }>;\n  exemptions: Array<{ coursecode: string }>;\n  degree: { _id: string; name: string; totalCredits: number } | null;\n}\n\nexport class UserController extends BaseMongoController<any> {\n  constructor() {\n    super(User, 'User');\n  }\n\n  // ==========================\n  // USER CRUD OPERATIONS\n  // ==========================\n\n  /**\n   * Create a new user\n   */\n  async createUser(userData: UserData): Promise<UserData> {\n    try {\n      // Check if user already exists\n      const existsResult = await this.exists({ email: userData.email });\n      if (existsResult.data) {\n        throw new Error('User with this email already exists.');\n      }\n\n      const userDataWithId = {\n        ...userData,\n        _id: userData._id || new mongoose.Types.ObjectId().toString(),\n      };\n\n      const result = await this.create(userDataWithId);\n\n      if (!result.success) {\n        throw new Error(result.error || 'Failed to create user');\n      }\n\n      return {\n        _id: result.data._id,\n        email: result.data.email,\n        fullname: result.data.fullname,\n        degree: result.data.degree,\n        type: result.data.type,\n        deficiencies: result.data.deficiencies,\n        exemptions: result.data.exemptions,\n      };\n    } catch (error) {\n      this.handleError(error, 'createUser');\n    }\n  }\n\n  /**\n   * Get user by ID\n   */\n  async getUserById(_id: string): Promise<UserData> {\n    try {\n      const result = await this.findById(_id);\n\n      if (!result.success) {\n        throw new Error(USER_WITH_ID_DOES_NOT_EXIST);\n      }\n\n      return {\n        _id: result.data._id,\n        email: result.data.email,\n        fullname: result.data.fullname,\n        degree: result.data.degree,\n        type: result.data.type,\n        deficiencies: result.data.deficiencies,\n        exemptions: result.data.exemptions,\n      };\n    } catch (error) {\n      this.handleError(error, 'getUserById');\n    }\n  }\n\n  /**\n   * Get all users\n   */\n  async getAllUsers(): Promise<UserData[]> {\n    try {\n      const result = await this.findAll(\n        {},\n        { select: 'email fullname degree type' },\n      );\n\n      if (!result.success) {\n        throw new Error('Failed to fetch users');\n      }\n\n      return (result.data || []).map((user) => ({\n        _id: user._id,\n        email: user.email,\n        fullname: user.fullname,\n        degree: user.degree,\n        type: user.type,\n        deficiencies: user.deficiencies,\n        exemptions: user.exemptions,\n      }));\n    } catch (error) {\n      this.handleError(error, 'getAllUsers');\n    }\n  }\n\n  /**\n   * Update user information\n   * Note: User type cannot be updated through this method for security reasons\n   */\n  async updateUser(_id: string, updates: Partial<UserData>) {\n    try {\n      // Remove type from updates to prevent unauthorized user type changes\n      const { type, ...safeUpdates } = updates;\n\n      if (type !== undefined) {\n        console.warn(\n          `Attempted to update user type for user ${_id}. This change was blocked.`,\n        );\n      }\n\n      const result = await this.updateById(_id, safeUpdates);\n\n      if (!result.success) {\n        throw new Error(USER_WITH_ID_DOES_NOT_EXIST);\n      }\n\n      return {\n        _id: result.data._id,\n        email: result.data.email,\n        password: result.data.password,\n        fullname: result.data.fullname,\n        degree: result.data.degree,\n      };\n    } catch (error) {\n      this.handleError(error, 'updateUser');\n    }\n  }\n\n  /**\n   * Delete user\n   */\n  async deleteUser(_id: string) {\n    try {\n      const result = await this.deleteById(_id);\n\n      if (!result.success) {\n        throw new Error(USER_WITH_ID_DOES_NOT_EXIST);\n      }\n\n      return `User with id ${_id} has been successfully deleted.`;\n    } catch (error) {\n      this.handleError(error, 'deleteUser');\n    }\n  }\n\n  /**\n   * Get comprehensive user data including timeline, deficiencies, exemptions, and degree info\n   */\n  async getUserData(_id: string): Promise<UserDataResponse> {\n    try {\n      // Fetch user and timeline in parallel\n      const [userResult, timelineResult] = await Promise.all([\n        this.findById(_id),\n        Timeline.find({ userId: _id }).lean().exec(),\n      ]);\n\n      if (!userResult.success || !userResult.data) {\n        throw new Error(USER_WITH_ID_DOES_NOT_EXIST);\n      }\n\n      const user = userResult.data;\n\n      // Flatten timeline structure\n      const timeline: Array<{\n        season: string;\n        year: number;\n        coursecode: string;\n      }> = [];\n      for (const tl of timelineResult) {\n        for (const item of tl.items || []) {\n          for (const coursecode of item.courses || []) {\n            timeline.push({\n              season: item.season,\n              year: item.year,\n              coursecode,\n            });\n          }\n        }\n      }\n\n      // Process deficiencies\n      const deficiencies = (user.deficiencies || []).map(\n        (def: { coursepool: string; creditsRequired: number }) => ({\n          coursepool: def.coursepool,\n          creditsRequired: def.creditsRequired,\n        }),\n      );\n\n      // Process exemptions\n      const exemptions = (user.exemptions || []).map((coursecode: string) => ({\n        coursecode,\n      }));\n\n      // Fetch degree info if available\n      let degree = null;\n      if (user.degree) {\n        const degreeDoc = await Degree.findById(user.degree).lean().exec();\n        if (degreeDoc) {\n          degree = {\n            _id: degreeDoc._id,\n            name: degreeDoc.name,\n            totalCredits: degreeDoc.totalCredits,\n          };\n        }\n      }\n\n      return {\n        user: {\n          _id: user._id as string,\n          email: user.email,\n          fullname: user.fullname,\n          type: user.type,\n          degree: user.degree || null,\n        },\n        timeline,\n        deficiencies,\n        exemptions,\n        degree,\n      };\n    } catch (error) {\n      this.handleError(error, 'getUserData');\n    }\n  }\n\n  // ==========================\n  // DEFICIENCY OPERATIONS\n  // ==========================\n\n  /**\n   * Create deficiency for user\n   */\n  async createDeficiency(\n    coursepool: string,\n    user_id: string,\n    creditsRequired: number,\n  ): Promise<DeficiencyData> {\n    try {\n      const userResult = await this.findById(user_id);\n      if (!userResult.success) {\n        throw new Error(USER_DOES_NOT_EXIST);\n      }\n\n      const user = userResult.data;\n\n      // Check if deficiency already exists\n      if (\n        user.deficiencies?.some(\n          (d: { coursepool: string }) => d.coursepool === coursepool,\n        )\n      ) {\n        throw new Error(\n          'Deficiency with this coursepool already exists. Please use the update endpoint',\n        );\n      }\n\n      // Add deficiency using atomic operation\n      const updateResult = await this.model\n        .findByIdAndUpdate(\n          user_id,\n          { $push: { deficiencies: { coursepool, creditsRequired } } },\n          { new: true },\n        )\n        .lean()\n        .exec();\n\n      if (!updateResult) {\n        throw new Error('Failed to update user deficiencies');\n      }\n\n      return { coursepool, user_id, creditsRequired };\n    } catch (error) {\n      this.handleError(error, 'createDeficiency');\n    }\n  }\n\n  /**\n   * Get all deficiencies for user\n   */\n  async getAllDeficienciesByUser(user_id: string): Promise<DeficiencyData[]> {\n    try {\n      const result = await this.findById(user_id, 'deficiencies');\n      if (!result.success) {\n        throw new Error(USER_DOES_NOT_EXIST);\n      }\n\n      return (result.data?.deficiencies || []).map(\n        (def: { coursepool: string; creditsRequired: number }) => ({\n          coursepool: def.coursepool,\n          user_id,\n          creditsRequired: def.creditsRequired,\n        }),\n      );\n    } catch (error) {\n      this.handleError(error, 'getAllDeficienciesByUser');\n    }\n  }\n\n  /**\n   * Update deficiency\n   */\n  async updateDeficiency(\n    coursepool: string,\n    user_id: string,\n    creditsRequired: number,\n  ): Promise<DeficiencyData> {\n    try {\n      const result = await this.model\n        .findOneAndUpdate(\n          { _id: user_id, 'deficiencies.coursepool': coursepool },\n          { $set: { 'deficiencies.$.creditsRequired': creditsRequired } },\n          { new: true },\n        )\n        .lean()\n        .exec();\n\n      if (!result) {\n        throw new Error('Deficiency not found.');\n      }\n\n      return { coursepool, user_id, creditsRequired };\n    } catch (error) {\n      this.handleError(error, 'updateDeficiency');\n    }\n  }\n\n  /**\n   * Delete deficiency\n   */\n  async deleteDeficiency(coursepool: string, user_id: string): Promise<string> {\n    try {\n      const result = await this.model\n        .findByIdAndUpdate(\n          user_id,\n          { $pull: { deficiencies: { coursepool } } },\n          { new: true },\n        )\n        .lean()\n        .exec();\n\n      if (!result) {\n        throw new Error(USER_DOES_NOT_EXIST);\n      }\n\n      return `Deficiency with coursepool ${coursepool} has been successfully deleted.`;\n    } catch (error) {\n      this.handleError(error, 'deleteDeficiency');\n    }\n  }\n\n  // ==========================\n  // EXEMPTION OPERATIONS\n  // ==========================\n\n  /**\n   * Create exemptions for user (bulk operation)\n   */\n  async createExemptions(coursecodes: string[], user_id: string) {\n    try {\n      const userResult = await this.findById(user_id, 'exemptions');\n      if (!userResult.success) {\n        throw new Error(`User with id '${user_id}' does not exist.`);\n      }\n\n      const existingExemptions = new Set(userResult.data?.exemptions || []);\n      const created: ExemptionData[] = [];\n      const alreadyExists: string[] = [];\n\n      // Validate all courses exist (parallel query)\n      const courseChecks = await Promise.all(\n        coursecodes.map((code) => Course.exists({ _id: code }).exec()),\n      );\n\n      coursecodes.forEach((code, index) => {\n        if (!courseChecks[index]) {\n          throw new Error(`Course with code '${code}' does not exist.`);\n        }\n\n        if (existingExemptions.has(code)) {\n          alreadyExists.push(code);\n        } else {\n          created.push({ coursecode: code, user_id });\n        }\n      });\n\n      // Bulk add new exemptions\n      if (created.length > 0) {\n        await this.model\n          .findByIdAndUpdate(user_id, {\n            $addToSet: {\n              exemptions: { $each: created.map((e) => e.coursecode) },\n            },\n          })\n          .exec();\n      }\n\n      return { created, alreadyExists };\n    } catch (error) {\n      this.handleError(error, 'createExemptions');\n    }\n  }\n\n  /**\n   * Get all exemptions for user\n   */\n  async getAllExemptionsByUser(user_id: string): Promise<ExemptionData[]> {\n    try {\n      const result = await this.findById(user_id, 'exemptions');\n      if (!result.success) {\n        throw new Error(`User with id '${user_id}' does not exist.`);\n      }\n\n      if (!result.data?.exemptions || result.data.exemptions.length === 0) {\n        return [];\n      }\n\n      return result.data.exemptions.map((code: string) => ({\n        coursecode: code,\n        user_id,\n      }));\n    } catch (error) {\n      this.handleError(error, 'getAllExemptionsByUser');\n    }\n  }\n\n  /**\n   * Delete exemption\n   */\n  async deleteExemption(coursecode: string, user_id: string): Promise<string> {\n    try {\n      const result = await this.model\n        .findByIdAndUpdate(\n          user_id,\n          { $pull: { exemptions: coursecode } },\n          { new: true },\n        )\n        .lean()\n        .exec();\n\n      if (!result) {\n        throw new Error(`User with id '${user_id}' does not exist.`);\n      }\n\n      return `Exemption with coursecode ${coursecode} has been successfully deleted.`;\n    } catch (error) {\n      this.handleError(error, 'deleteExemption');\n    }\n  }\n}\n\nexport const userController = new UserController();\n"]}