{"version":3,"file":"degreeController.js","sourceRoot":"","sources":["../../../controllers/degreeController/degreeController.ts"],"names":[],"mappings":"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","sourcesContent":["import Database from '@controllers/DBController/DBController';\nimport DegreeTypes from '@controllers/degreeController/degree_types';\nimport { captureException } from '@sentry/node';\n\nconst SELECT_DEGREE_BY_ID = 'SELECT * FROM Degree WHERE id = @id';\nconst DEGREE_WITH_ID_DOES_NOT_EXIST = 'Degree with this id does not exist.';\n\n/**\n * Creates a new degree in the database.\n *\n * @param {string} id - The unique identifier for the degree.\n * @param {string} name - The name of the degree.\n * @param {number} totalCredits - The total number of credits required to complete the degree.\n * @returns {Promise<DegreeTypes.Degree | undefined>} - The created degree object or undefined if the operation fails.\n */\nasync function createDegree(\n  id: string,\n  name: string,\n  totalCredits: number,\n): Promise<DegreeTypes.Degree | undefined> {\n  const conn = await Database.getConnection();\n\n  if (conn) {\n    try {\n      // Check if a degree with the same id or name already exists\n      const existingDegree = await conn\n        .request()\n        .input('id', Database.msSQL.VarChar, id)\n        .input('name', Database.msSQL.VarChar, name)\n        .query('SELECT * FROM Degree WHERE id = @id OR name = @name');\n\n      if (existingDegree.recordset.length > 0) {\n        throw new Error('Degree with this id or name already exists.');\n      }\n\n      await conn\n        .request()\n        .input('id', Database.msSQL.VarChar, id)\n        .input('name', Database.msSQL.VarChar, name)\n        .input('totalCredits', Database.msSQL.Int, totalCredits)\n        .query(\n          'INSERT INTO Degree (id, name, totalCredits) VALUES (@id, @name, @totalCredits)',\n        );\n\n      return { id, name, totalCredits };\n    } catch (error) {\n      captureException(error);\n      throw error;\n    } finally {\n      conn.close();\n    }\n  }\n}\n\n/**\n * Retrieves a degree by its ID.\n *\n * @param {string} id - The unique identifier for the degree.\n * @returns {Promise<DegreeTypes.Degree | undefined>} - The degree object or undefined if the degree is not found.\n */\nasync function readDegree(id: string): Promise<DegreeTypes.Degree | undefined> {\n  const conn = await Database.getConnection();\n\n  if (conn) {\n    try {\n      // Check if a degree with the id exists\n      const degree = await conn\n        .request()\n        .input('id', Database.msSQL.VarChar, id)\n        .query(SELECT_DEGREE_BY_ID);\n\n      if (degree.recordset.length === 0) {\n        throw new Error(DEGREE_WITH_ID_DOES_NOT_EXIST);\n      }\n\n      return degree.recordset[0];\n    } catch (error) {\n      captureException(error);\n      throw error;\n    } finally {\n      conn.close();\n    }\n  }\n}\n/**\n * Retrieves all degrees from the database.\n *\n * @returns {Promise<DegreeTypes.Degree[] | undefined>} - A list of all degrees or undefined if no degrees are found.\n */\nasync function readAllDegrees(): Promise<DegreeTypes.Degree[] | undefined> {\n  const conn = await Database.getConnection();\n\n  if (conn) {\n    try {\n      const degrees = await conn\n        .request()\n        .query(\"SELECT * FROM Degree WHERE id != 'ECP'\");\n\n      return degrees.recordset;\n    } catch (error) {\n      captureException(error);\n      throw error;\n    } finally {\n      conn.close();\n    }\n  }\n}\n\n/**\n * Updates an existing degree with new information.\n *\n * @param {string} id - The unique identifier for the degree.\n * @param {string} name - The new name of the degree.\n * @param {number} totalCredits - The new total credits for the degree.\n * @returns {Promise<DegreeTypes.Degree | undefined>} - The updated degree object or undefined if the update fails.\n */\nasync function updateDegree(\n  id: string,\n  name: string,\n  totalCredits: number,\n): Promise<DegreeTypes.Degree | undefined> {\n  const conn = await Database.getConnection();\n\n  if (conn) {\n    try {\n      // Check if a degree with the id exists\n      const degree = await conn\n        .request()\n        .input('id', Database.msSQL.VarChar, id)\n        .query(SELECT_DEGREE_BY_ID);\n\n      if (degree.recordset.length === 0) {\n        throw new Error(DEGREE_WITH_ID_DOES_NOT_EXIST);\n      }\n\n      // Update the degree with the new name and totalCredits\n      await conn\n        .request()\n        .input('id', Database.msSQL.VarChar, id)\n        .input('fullname', Database.msSQL.VarChar, name)\n        .input('totalCredits', Database.msSQL.Int, totalCredits)\n        .query(\n          'UPDATE Degree SET name = @fullname, totalCredits = @totalCredits WHERE id = @id',\n        );\n\n      // Return the updated degree\n      const updatedDegree = await conn\n        .request()\n        .input('id', Database.msSQL.VarChar, id)\n        .query(SELECT_DEGREE_BY_ID);\n\n      return updatedDegree.recordset[0];\n    } catch (error) {\n      captureException(error);\n      throw error;\n    } finally {\n      conn.close();\n    }\n  }\n}\n/**\n * Deletes a degree from the database by its ID.\n *\n * @param {string} id - The unique identifier for the degree to delete.\n * @returns {Promise<string | undefined>} - A success message if the degree is deleted or undefined if the deletion fails.\n */\nasync function deleteDegree(id: string): Promise<string | undefined> {\n  const conn = await Database.getConnection();\n\n  if (conn) {\n    try {\n      // Check if a degree with the given id exists\n      const degree = await conn\n        .request()\n        .input('id', Database.msSQL.VarChar, id)\n        .query(SELECT_DEGREE_BY_ID);\n\n      if (degree.recordset.length === 0) {\n        throw new Error(DEGREE_WITH_ID_DOES_NOT_EXIST);\n      }\n\n      // Delete the degree\n      await conn\n        .request()\n        .input('id', Database.msSQL.VarChar, id)\n        .query('DELETE FROM Degree WHERE id = @id');\n\n      // Return success message\n      return `Degree with id ${id} has been successfully deleted.`;\n    } catch (error) {\n      captureException(error);\n      throw error;\n    } finally {\n      conn.close();\n    }\n  }\n}\n\nasync function getCreditsForDegree(\n  degreeId: string,\n): Promise<number | undefined> {\n  const conn = await Database.getConnection();\n\n  if (conn) {\n    try {\n      // Check if a degree with the id exists\n      const degree = await conn\n        .request()\n        .input('id', Database.msSQL.VarChar, degreeId)\n        .query(SELECT_DEGREE_BY_ID);\n\n      if (degree.recordset.length === 0) {\n        throw new Error(DEGREE_WITH_ID_DOES_NOT_EXIST);\n      }\n\n      return degree.recordset[0].totalCredits;\n    } catch (error) {\n      captureException(error);\n      throw error;\n    } finally {\n      conn.close();\n    }\n  }\n}\n\n//Namespace\nconst degreeController = {\n  createDegree,\n  readDegree,\n  updateDegree,\n  deleteDegree,\n  readAllDegrees,\n  getCreditsForDegree,\n};\n\nexport default degreeController;\n"]}