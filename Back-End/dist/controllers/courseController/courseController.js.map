{"version":3,"file":"courseController.js","sourceRoot":"","sources":["../../../controllers/courseController/courseController.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Purpose:\n *  - Course controller responsible for managing courses and their requisites.\n *    Provides functions to fetch, add, delete, and group courses\n * Notes:\n *  - Integrates Redis for caching heavy queries (getAll, byDegree, etc.).\n *  - Relies on DBController for SQL Server interactions\n *  - Sentry is used for eror tracking and monitoring.\n *  - Types (e.g., CourseTypes.CourseInfo) are imported from course_types.d.ts.\n */\n\nimport Database from '@controllers/DBController/DBController';\nimport CourseTypes from './course_types';\nimport * as Sentry from '@sentry/node';\nimport redisClient from '@controllers/redisClient';\n\nconst log = console.log;\n\nconst ERROR_READING_FROM_REDIS = 'Error reading from Redis cache';\nconst ERROR_WRITING_TO_REDIS = 'Error writing to Redis cache';\n\nasync function getFromCache(key: string): Promise<string | null> {\n  try {\n    return await redisClient.get(key);\n  } catch (err) {\n    Sentry.captureException(new Error('Error getting cache'));\n    console.error('Error getting cache:', err);\n    return null;\n  }\n}\n\nasync function setCache(\n  key: string,\n  value: string,\n  ttl: number,\n): Promise<void> {\n  try {\n    await redisClient.setEx(key, ttl, value);\n  } catch (err) {\n    Sentry.captureException(new Error('Error setting cache'));\n    console.error('Error setting cache:', err);\n  }\n}\n\n/**\n * Retrieves all courses along with their requisites,\n * using Redis caching.\n *\n * @returns {Promise<CourseTypes.CourseInfo[] | undefined>} - List of courses or undefined if an error occurs.\n */\nasync function getAllCourses(): Promise<CourseTypes.CourseInfo[] | undefined> {\n  const cacheKey = 'getAllCourses';\n\n  // Try to fetch from cache first\n  try {\n    const cachedData = await redisClient.get(cacheKey);\n    if (cachedData) {\n      log('Serving getAllCourses from Redis cache');\n      return JSON.parse(cachedData) as CourseTypes.CourseInfo[];\n    }\n  } catch (cacheError) {\n    Sentry.captureException(new Error(ERROR_READING_FROM_REDIS));\n    log(ERROR_READING_FROM_REDIS, cacheError);\n    // Proceed to query the database if cache fails\n  }\n\n  const dbConn = await Database.getConnection();\n  if (dbConn) {\n    try {\n      const result = await dbConn.request().query(`\n        SELECT \n            c.code, \n            c.title, \n            c.credits, \n            c.description,\n            c.offeredIn,\n            req.requisite_code1, \n            req.requisite_code2, \n            req.requisite_type\n        FROM Course c\n        LEFT JOIN (\n            SELECT code1 AS requisite_code1, code2 AS requisite_code2, type AS requisite_type\n            FROM Requisite\n            UNION ALL\n            SELECT code2 AS requisite_code1, code1 AS requisite_code2, type AS requisite_type\n            FROM Requisite\n        ) req ON c.code = req.requisite_code1\n      `);\n\n      const courses = result.recordset;\n\n      const coursesWithRequisites = courses.reduce((acc: any, course: any) => {\n        const courseCode = course.code;\n        if (!acc[courseCode]) {\n          acc[courseCode] = {\n            code: course.code,\n            title: course.title,\n            credits: course.credits,\n            description: course.description,\n            offeredIn: course.offeredIn,\n            requisites: [],\n          };\n        }\n\n        // Only pushes requisites when both code1 and code2 exist.\n        // If there is a requisite with only one side populated it will be skipped.\n\n        if (course.requisite_code1 && course.requisite_code2) {\n          acc[courseCode].requisites.push({\n            code1: course.requisite_code1,\n            code2: course.requisite_code2,\n            type: course.requisite_type,\n          });\n        }\n        return acc;\n      }, {});\n\n      const resultData = Object.values(\n        coursesWithRequisites,\n      ) as CourseTypes.CourseInfo[];\n\n      // Cache the result for 1 hour (3600 seconds)\n      try {\n        await redisClient.setEx(cacheKey, 3600, JSON.stringify(resultData));\n      } catch (cacheError) {\n        Sentry.captureException(new Error(ERROR_WRITING_TO_REDIS));\n        log(ERROR_WRITING_TO_REDIS, cacheError);\n      }\n\n      return resultData;\n    } catch (error) {\n      Sentry.captureException(\n        new Error('Error fetching courses with requisites'),\n      );\n      log('Error fetching courses with requisites\\n', error);\n    }\n  }\n\n  return undefined;\n}\n\n/**\n * Retrieves a specific course by its unique code.\n *\n * @param {string} code - The course code to search for.\n * @returns {Promise<CourseTypes.CourseInfo | undefined>} - The course details, or undefined if not found.\n */\nasync function getCourseByCode(\n  code: string,\n): Promise<CourseTypes.CourseInfoDB | undefined> {\n  const dbConn = await Database.getConnection();\n\n  if (dbConn) {\n    try {\n      // Fetch course details\n      const courseResult = await dbConn\n        .request()\n        .input('code', Database.msSQL.VarChar, code)\n        .query(\n          'SELECT code, title, credits, description, offeredIn FROM Course WHERE code = @code',\n        );\n\n      const course = courseResult.recordset[0];\n      if (!course) {\n        return undefined;\n      }\n\n      // Fetch requisites\n      const requisitesResult = await dbConn\n        .request()\n        .input('code', Database.msSQL.VarChar, code).query(`\n                    SELECT r.type, r.code2 AS requisiteCode, c.description AS requisiteDescription\n                    FROM Requisite r\n                    INNER JOIN Course c ON r.code2 = c.code\n                    WHERE r.code1 = @code\n                `);\n\n      // Construct course object with requisites\n      return {\n        code: course.code,\n        title: course.title,\n        credits: course.credits,\n        description: course.description,\n        offeredIn: course.offeredIn,\n        requisites: requisitesResult.recordset.map((row: any) => ({\n          type: row.type,\n          code: row.requisiteCode,\n          description: row.requisiteDescription,\n        })),\n      };\n    } catch (error) {\n      Sentry.captureException(new Error('Error fetching course by code'));\n      console.error('Error fetching course by code\\n', error);\n    }\n  }\n\n  return undefined;\n}\n\n/**\n * Adds a new course to the database.\n *\n *\n * @param {CourseTypes.CourseInfo} courseInfo - The course details.\n * @returns {Promise<{ code: string } | undefined>} - The inserted course's code, or undefined on failure.\n */\nasync function addCourse(\n  courseInfo: CourseTypes.CourseInfo,\n): Promise<{ code: string } | undefined> {\n  const dbConn = await Database.getConnection();\n\n  if (dbConn) {\n    const { code, title, credits, description } = courseInfo;\n\n    // using a boolean check for credits will reject 0. Although I believe 0 credit courses do not exist\n    // non credits courses may be confused with and hence rejected\n    // consider checking credits == null instead.\n    if (!code || !title || !credits || !description) {\n      throw new Error('Missing required course data');\n    }\n\n    try {\n      const result = await dbConn\n        .request()\n        .input('code', Database.msSQL.VarChar, code)\n        .input('title', Database.msSQL.VarChar, title)\n        .input('credits', Database.msSQL.Int, credits)\n        .input('offeredIn', Database.msSQL.VarChar, courseInfo.offeredIn)\n        .input('description', Database.msSQL.VarChar, description).query(`\n                    INSERT INTO Course (code, title, credits, description, offeredIn)\n                    OUTPUT INSERTED.code\n                    VALUES (@code, @title, @credits, @description, @offeredIn)\n                `);\n\n      return result.recordset[0];\n    } catch (error) {\n      Sentry.captureException(new Error('Error adding course'));\n      log('Error adding course\\n', error);\n    }\n  }\n\n  return undefined;\n}\n\n/**\n * Deletes a course from the database.\n *\n *\n * @param {string} code - The course code to delete.\n * @returns {Promise<boolean>} - True if deleted successfully, false otherwise.\n */\nasync function removeCourse(code: string): Promise<boolean> {\n  const dbConn = await Database.getConnection();\n\n  if (dbConn) {\n    try {\n      const result = await dbConn\n        .request()\n        .input('code', Database.msSQL.VarChar, code)\n        .query('DELETE FROM Course WHERE code = @code');\n\n      return result.rowsAffected[0] > 0;\n    } catch (error) {\n      Sentry.captureException(new Error('Error removing course'));\n      console.error('Error removing course\\n', error);\n      throw error;\n    }\n  }\n\n  return false;\n}\n\n/**\n * Retrieves courses grouped by course pools for a given degree,\n * using Redis caching.\n *\n * @param {string} degreeId - The ID of the degree.\n * @returns {Promise<CourseTypes.CoursePoolInfo[] | undefined>} - The grouped courses, or undefined on failure.\n */\nasync function getCoursesByDegreeGrouped(\n  degreeId: string,\n): Promise<CourseTypes.CoursePoolInfo[] | undefined> {\n  const cacheKey = `coursesByDegreeGrouped:${degreeId}`;\n\n  try {\n    const cachedData = await redisClient.get(cacheKey);\n    if (cachedData) {\n      log('Serving getCoursesByDegreeGrouped from Redis cache');\n      return JSON.parse(cachedData) as CourseTypes.CoursePoolInfo[];\n    }\n  } catch (cacheError) {\n    Sentry.captureException(new Error(ERROR_READING_FROM_REDIS));\n    log(ERROR_READING_FROM_REDIS, cacheError);\n    // Continue to query the database if cache read fails\n  }\n\n  const dbConn = await Database.getConnection();\n  if (!dbConn) return undefined;\n\n  try {\n    const query = `\n      WITH Courses AS (\n        SELECT \n          cp.id AS course_pool_id, \n          cp.name AS course_pool_name, \n          c.code, \n          c.title, \n          c.credits, \n          c.description,\n          c.offeredIn\n        FROM DegreeXCoursePool dxcp\n        INNER JOIN CourseXCoursePool cxcp ON dxcp.coursepool = cxcp.coursepool\n        INNER JOIN Course c ON cxcp.coursecode = c.code\n        INNER JOIN CoursePool cp ON cxcp.coursepool = cp.id\n        WHERE dxcp.degree = @degreeId\n      )\n      SELECT \n        c.course_pool_id, \n        c.course_pool_name, \n        c.code, \n        c.title, \n        c.credits, \n        c.description,\n        c.offeredIn,\n        ISNULL(\n          (SELECT \n             r.code1, \n             r.code2, \n             r.group_id, \n             r.type\n           FROM Requisite r\n           WHERE r.code1 = c.code\n           FOR JSON PATH\n          ), '[]'\n        ) AS requisites_json\n      FROM Courses c\n      ORDER BY c.course_pool_name, c.code;\n    `;\n\n    const result = await dbConn\n      .request()\n      .input('degreeId', Database.msSQL.VarChar, degreeId)\n      .query(query);\n\n    const records = result.recordset;\n    if (records.length === 0) return undefined;\n\n    const coursePoolsMap: { [key: string]: CourseTypes.CoursePoolInfo } = {};\n\n    records.forEach((record: any) => {\n      let requisites: any[] = [];\n      try {\n        requisites = JSON.parse(record.requisites_json);\n      } catch (e) {\n        requisites = [];\n      }\n      const poolId = record.course_pool_id;\n      if (!coursePoolsMap[poolId]) {\n        coursePoolsMap[poolId] = {\n          poolId: poolId,\n          poolName: record.course_pool_name,\n          courses: [],\n        };\n      }\n\n      // Create a course object with its requisites\n      const course = {\n        code: record.code,\n        title: record.title,\n        credits: record.credits,\n        description: record.description,\n        offeredIn: record.offeredIn,\n        requisites: requisites,\n      };\n\n      coursePoolsMap[poolId].courses.push(course);\n    });\n\n    const resultData = Object.values(coursePoolsMap);\n\n    try {\n      // Cache the result in Redis for 3600 seconds (1 hour)\n      // This comment above says 1 hour but in reality I believe they later extended to 604800s (1 week)\n      // We may change TTL if needed\n      await redisClient.setEx(cacheKey, 604800, JSON.stringify(resultData));\n    } catch (cacheError) {\n      Sentry.captureException(new Error(ERROR_WRITING_TO_REDIS));\n      log(ERROR_WRITING_TO_REDIS, cacheError);\n    }\n\n    return resultData;\n  } catch (error) {\n    Sentry.captureException(\n      new Error('Error fetching courses by degree grouped by course pools'),\n    );\n    log('Error fetching courses by degree grouped by course pools\\n', error);\n  }\n\n  return undefined;\n}\n\n/**\n * Retrieves all courses from the database, including their requisites,\n * using Redis caching.\n *\n * @returns {Promise<CourseTypes.CourseInfo[] | undefined>} - A list of courses with their requisite information, or undefined on failure.\n */\nasync function getAllCoursesInDB(): Promise<\n  CourseTypes.CourseInfo[] | undefined\n> {\n  const cacheKey = 'getAllCoursesInDB';\n\n  // Try to fetch from Redis cache first\n  try {\n    const cachedData = await redisClient.get(cacheKey);\n    if (cachedData) {\n      log('Serving getAllCoursesInDB from Redis cache');\n      return JSON.parse(cachedData) as CourseTypes.CourseInfo[];\n    }\n  } catch (cacheError) {\n    Sentry.captureException(new Error(ERROR_READING_FROM_REDIS));\n    log(ERROR_READING_FROM_REDIS, cacheError);\n    // Continue to query the database if cache fails\n  }\n\n  const dbConn = await Database.getConnection();\n  if (dbConn) {\n    try {\n      const result = await dbConn.request().query(`\n        SELECT \n            c.code, \n            c.title,\n            c.credits, \n            c.description,\n            c.offeredIn,\n            r.code1 AS requisite_code1, \n            r.code2 AS requisite_code2, \n            r.group_id AS requisite_group_id,\n            r.type AS requisite_type\n        FROM Course c\n        LEFT JOIN Requisite r ON c.code = r.code1\n        ORDER BY c.code\n      `);\n\n      const records = result.recordset;\n      if (!records || records.length === 0) {\n        return undefined;\n      }\n\n      // Build a map keyed by course code\n      const coursesMap: { [key: string]: CourseTypes.CourseInfoDB } = {};\n\n      records.forEach((record: any) => {\n        const courseCode = record.code;\n        if (!coursesMap[courseCode]) {\n          coursesMap[courseCode] = {\n            code: record.code,\n            title: record.title,\n            credits: record.credits,\n            description: record.description,\n            offeredIn: record.offeredIn,\n            requisites: [],\n          };\n        }\n        // Add requisite information if available\n        if (record.requisite_code1 && record.requisite_code2) {\n          coursesMap[courseCode].requisites.push({\n            code1: record.requisite_code1,\n            code2: record.requisite_code2,\n            group_id: record.requisite_group_id,\n            type: record.requisite_type,\n          });\n        }\n      });\n\n      const resultData = Object.values(coursesMap) as CourseTypes.CourseInfo[];\n\n      // Cache the result in Redis for 1 hour (3600 seconds)\n      // Also 1 week here\n      try {\n        await redisClient.setEx(cacheKey, 604800, JSON.stringify(resultData));\n      } catch (cacheError) {\n        Sentry.captureException(new Error(ERROR_WRITING_TO_REDIS));\n        log(ERROR_WRITING_TO_REDIS, cacheError);\n      }\n\n      return resultData;\n    } catch (error) {\n      Sentry.captureException(new Error('Error fetching all courses'));\n      log('Error fetching all courses\\n', error);\n    }\n  }\n\n  return undefined;\n}\n\nconst courseController = {\n  getAllCourses,\n  getCourseByCode,\n  addCourse,\n  removeCourse,\n  getCoursesByDegreeGrouped,\n  getAllCoursesInDB,\n};\n\nexport default courseController;\n"]}