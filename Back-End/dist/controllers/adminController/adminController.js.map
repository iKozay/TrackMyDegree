{"version":3,"file":"adminController.js","sourceRoot":"","sources":["../../../controllers/adminController/adminController.ts"],"names":[],"mappings":"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","sourcesContent":["// src/controllers/adminController.ts\n\n/**\n * This controller handles all the admin-facing database operations such as\n * - Creating JSON backups of key tables\n * - Listing, restoring, and deleting backups\n * - Seeding the DB with requirement + course data\n * - Utility endpoints for fetching tables and records\n * The idea here is to give admins tools to snapshot the DB state,\n * roll back if needed, and keep course/degree data fresh\n */\n\nimport { Request, Response, NextFunction } from 'express';\nimport Database from '@controllers/DBController/DBController'; // Your database connection utility\nimport {\n  TableListResponse,\n  TableRecordsResponse,\n  GetTableRecordsRequest,\n  StandardResponse,\n  TableRecord,\n} from '@controllers/adminController/admin_types';\n\nimport fs from 'fs';\nimport { promises as fsPromises } from 'fs';\nimport path from 'path';\nimport * as sql from 'mssql';\nimport 'dotenv/config';\nimport { readdir } from 'fs/promises';\nimport * as Sentry from '@sentry/node';\n\n// only tables we actually backup or restore\n// restricted on purpose to avoid wiping out unrelated DB state\nconst allowedTables = [\n  'AppUser',\n  'Timeline',\n  'TimelineItems',\n  'TimelineItemXCourses',\n  'Feedback',\n];\n\nconst DB_CONNECTION_FAILED = 'Database connection failed';\n\n/**\n * below is the reverse order well delete tables in when restoring\n * because oforeign key constraints. Delete child tables first,\n * to avoid errors from parent references.\n */\nconst allTablesReversed = [\n  'Feedback',\n  'Exemption',\n  'Deficiency',\n  'TimelineItemXCourses',\n  'TimelineItems',\n  'Timeline',\n  'AppUser',\n  'CourseXCoursePool',\n  'DegreeXCoursePool',\n  'CoursePool',\n  'Requisite',\n  'Course',\n  'Degree',\n];\n\n// helper to resolve where backups should be stored. Falls back to ./backups if no env var is provided.\nconst getBackupDir = (): string => {\n  return process.env.BACKUP_DIR || path.join(__dirname, '../../backups');\n};\n\n/**\n * Create a full JSON backup of all allowed tables. Each tables data dumped into one big JSON file with timestamp.\n */\nexport const createBackup = async (\n  req: Request,\n  res: Response,\n  next: NextFunction,\n): Promise<void> => {\n  try {\n    const pool = await Database.getConnection();\n    if (!pool) {\n      res.status(500).json({ success: false, message: DB_CONNECTION_FAILED });\n      return;\n    }\n    // Query to get all table names in the current database\n    const tableQuery = `\n      SELECT TABLE_NAME \n      FROM INFORMATION_SCHEMA.TABLES \n      WHERE TABLE_TYPE = 'BASE TABLE' \n        AND TABLE_CATALOG = '${process.env.SQL_SERVER_DATABASE}'\n        AND TABLE_NAME IN (${allowedTables.map((t) => `'${t}'`).join(',')})\n    `;\n    const tableResult = await pool.request().query(tableQuery);\n    const tables: string[] = tableResult.recordset.map(\n      (row: { TABLE_NAME: string }) => row.TABLE_NAME,\n    );\n\n    // Create an object mapping table names to their records\n    const backupData: Record<string, any[]> = {};\n    for (const tableName of tables) {\n      const result = await pool.request().query(`SELECT * FROM [${tableName}]`);\n      backupData[tableName] = result.recordset;\n    }\n\n    // Generate a backup filename with a timestamp (replace colons and dots)\n    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');\n    const backupFileName = `backup-${timestamp}.json`;\n    const backupDir = getBackupDir();\n\n    // Ensure the backup directory exists\n    if (!fs.existsSync(backupDir)) {\n      fs.mkdirSync(backupDir, { recursive: true });\n    }\n    const backupFilePath = path.join(backupDir, backupFileName);\n\n    // Write backup data as pretty-printed JSON\n    await fsPromises.writeFile(\n      backupFilePath,\n      JSON.stringify(backupData, null, 2),\n      'utf-8',\n    );\n\n    res.status(200).json({\n      success: true,\n      message: 'Backup created successfully',\n      data: backupFileName,\n    });\n  } catch (error) {\n    Sentry.captureException(error);\n    console.error('Error creating backup:', error);\n    res\n      .status(500)\n      .json({ success: false, message: 'Error creating backup', data: error });\n  }\n};\n\n/**\n * Lists the available backup files from the backup directory.\n */\nexport const listBackups = async (\n  req: Request,\n  res: Response,\n  next: NextFunction,\n): Promise<void> => {\n  try {\n    const backupDir = getBackupDir();\n    // If the backup directory doesn't exist, return an empty list\n    if (!fs.existsSync(backupDir)) {\n      res.status(200).json({ success: true, data: [] });\n      return;\n    }\n    const files = await fsPromises.readdir(backupDir);\n    // Filter to include only .json files\n    const backups = files.filter((file) => file.endsWith('.json'));\n    res.status(200).json({ success: true, data: backups });\n  } catch (error) {\n    Sentry.captureException(error);\n    console.error('Error listing backups:', error);\n    res\n      .status(500)\n      .json({ success: false, message: 'Error listing backups', data: error });\n  }\n};\n\n/**\n * Restores the database from the backup file.\n * This function reads the JSON backup file, then for each table:\n * 1. Deletes all records.\n * 2. Inserts the backed-up records.\n * All insertions are wrapped in a transaction.\n */\nexport const restoreBackup = async (\n  req: Request,\n  res: Response,\n  next: NextFunction,\n): Promise<void> => {\n  try {\n    const { backupName } = req.body;\n    if (!backupName) {\n      res\n        .status(400)\n        .json({ success: false, message: 'Backup name is required' });\n      return;\n    }\n    const backupDir = getBackupDir();\n    const backupFilePath = path.join(backupDir, backupName);\n    if (!fs.existsSync(backupFilePath)) {\n      res\n        .status(404)\n        .json({ success: false, message: 'Backup file not found' });\n      return;\n    }\n    const backupContent = await fsPromises.readFile(backupFilePath, 'utf-8');\n    const backupData = JSON.parse(backupContent);\n\n    // Filter backupData to only include allowed tables\n    const filteredBackupData: Record<string, any[]> = {};\n    for (const tableName of Object.keys(backupData)) {\n      if (allowedTables.includes(tableName)) {\n        filteredBackupData[tableName] = backupData[tableName];\n      }\n    }\n\n    const pool = await Database.getConnection();\n    if (!pool) {\n      res.status(500).json({ success: false, message: DB_CONNECTION_FAILED });\n      return;\n    }\n\n    await deleteAll(pool).catch((error) => {\n      throw error;\n    });\n\n    await reseedData(res).catch((error) => {\n      throw error;\n    });\n\n    await insertBackupData(pool, filteredBackupData, res).catch((error) => {\n      throw error;\n    });\n\n  } catch (error) {\n    Sentry.captureException(error);\n    console.error('Error restoring backup:', error);\n    res\n      .status(500)\n      .json({ success: false, message: 'Error restoring backup', data: error });\n  }\n};\n\nconst deleteAll = async (\n  pool: sql.ConnectionPool\n): Promise<void> => {\n      // ========================================================\n    // Step 1: Delete records from ALL allowed tables in reverse order\n    // ========================================================\n    const deletionTx = pool.transaction();\n    await deletionTx.begin();\n    try {\n      for (const tableName of allTablesReversed) {\n        await deletionTx.request().query(`DELETE FROM [${tableName}]`);\n      }\n      await deletionTx.commit();\n      console.log('Allowed tables deleted successfully.');\n    } catch (deleteError) {\n      await deletionTx.rollback();\n      throw deleteError;\n    }\n};\n\nconst reseedData = async (\n  res: Response\n): Promise<void> => {\n      // ========================================================\n    // Step 2: Reseed the database using seedSoenDegree function\n    // ========================================================\n    console.log('Reseeding database...');\n    await seedSoenDegree();\n    console.log('Database reseeded successfully.');\n\n    const newPool = await Database.getConnection();\n    if (!newPool) {\n      res.status(500).json({ success: false, message: DB_CONNECTION_FAILED });\n      return;\n    }\n};\n\nconst insertBackupData = async (\n  newPool: sql.ConnectionPool,\n  filteredBackupData: Record<string, any[]>,\n  res: Response\n): Promise<void> => {\n      // ========================================================\n    // Step 3: Insert backup data into allowed tables\n    // ========================================================\n    const insertTx = newPool.transaction();\n    await insertTx.begin();\n    try {\n      for (const tableName of Object.keys(filteredBackupData)) {\n        // Delete any leftover records (just in case)\n        await insertTx.request().query(`DELETE FROM [${tableName}]`);\n        const records: any[] = filteredBackupData[tableName];\n        if (records.length === 0) continue;\n        for (const record of records) {\n          const columns = Object.keys(record);\n          const values = columns.map((col) => record[col]);\n          const columnsJoined = columns.map((col) => `[${col}]`).join(', ');\n          const placeholders = columns.map((_, idx) => `@p${idx}`).join(', ');\n          const insertRequest = insertTx.request();\n          columns.forEach((col, idx) => {\n            insertRequest.input(`p${idx}`, values[idx]);\n          });\n\n          try {\n            await insertRequest.query(\n              `INSERT INTO [${tableName}] (${columnsJoined}) VALUES (${placeholders})`,\n            );\n          } catch (error) {\n            if (\n              error instanceof Error &&\n              error.message.includes('FOREIGN KEY constraint')\n            ) {\n              console.error(\n                `Foreign key constraint error while inserting into table \"${tableName}\". Record:`,\n                record,\n              );\n            }\n            throw error;\n          }\n        }\n      }\n      await insertTx.commit();\n      console.log('Backup data inserted successfully.');\n      res\n        .status(200)\n        .json({ success: true, message: 'Database restored successfully' });\n    } catch (insertError) {\n      await insertTx.rollback();\n      throw insertError;\n    }\n};  \n\n/**\n * Deletes a backup file from the backup directory.\n */\nexport const deleteBackup = async (\n  req: Request,\n  res: Response,\n  next: NextFunction,\n): Promise<void> => {\n  try {\n    const { backupName } = req.body;\n    if (!backupName) {\n      res\n        .status(400)\n        .json({ success: false, message: 'Backup name is required' });\n      return;\n    }\n    const backupDir = getBackupDir();\n    const backupFilePath = path.join(backupDir, backupName);\n    if (!fs.existsSync(backupFilePath)) {\n      res\n        .status(404)\n        .json({ success: false, message: 'Backup file not found' });\n      return;\n    }\n    await fsPromises.unlink(backupFilePath);\n    res\n      .status(200)\n      .json({ success: true, message: 'Backup deleted successfully' });\n  } catch (error) {\n    Sentry.captureException(error);\n    console.error('Error deleting backup:', error);\n    res\n      .status(500)\n      .json({ success: false, message: 'Error deleting backup', data: error });\n  }\n};\n\n// Admin Utilities\n\n/**\n * Fetches the list of all tables in the database.\n */\nexport const getTables = async (\n  req: Request,\n  res: Response<StandardResponse>,\n  next: NextFunction,\n): Promise<void> => {\n  try {\n    const pool = await Database.getConnection();\n    if (!pool) {\n      res.status(500).json({ success: false, message: DB_CONNECTION_FAILED });\n      return;\n    }\n\n    const query = `\n      SELECT TABLE_NAME \n      FROM INFORMATION_SCHEMA.TABLES \n      WHERE TABLE_TYPE = 'BASE TABLE' \n        AND TABLE_CATALOG = '${process.env.SQL_SERVER_DATABASE}'\n    `;\n\n    const result = await pool.request().query(query);\n    const tables: TableListResponse = result.recordset.map(\n      (row: { TABLE_NAME: string }) => row.TABLE_NAME,\n    );\n    res.status(200).json({ success: true, data: tables });\n  } catch (error) {\n    console.error('Error fetching tables:', error);\n    res\n      .status(500)\n      .json({ success: false, message: 'Error fetching tables', data: error });\n  }\n};\n\n/**\n * Fetches records from a specific table with optional keyword filtering.\n */\nexport const getTableRecords = async (\n  req: GetTableRecordsRequest,\n  res: Response<StandardResponse>,\n  next: NextFunction,\n): Promise<void> => {\n  const { tableName } = req.params;\n  const { keyword } = req.query;\n\n  try {\n    const pool = await Database.getConnection();\n    if (!pool) {\n      res.status(500).json({ success: false, message: DB_CONNECTION_FAILED });\n      Sentry.captureException({ error: DB_CONNECTION_FAILED });\n      return;\n    }\n\n    let query = `SELECT * FROM [${tableName}]`;\n    if (keyword) {\n      // Fetch text-based columns for keyword search\n      const columnsResult = await pool.request().query(`\n        SELECT COLUMN_NAME \n        FROM INFORMATION_SCHEMA.COLUMNS \n        WHERE TABLE_NAME = '${tableName}' \n          AND DATA_TYPE IN ('varchar', 'nvarchar', 'text', 'char')\n      `);\n      const columns: string[] = columnsResult.recordset.map(\n        (row: { COLUMN_NAME: string }) => row.COLUMN_NAME,\n      );\n      if (columns.length > 0) {\n        const whereClauses = columns.map(\n          (col) => `[${col}] LIKE '%${keyword}%'`,\n        );\n        query += ` WHERE ${whereClauses.join(' OR ')}`;\n      }\n    }\n    const result = await pool.request().query(query);\n    const records: TableRecordsResponse = result.recordset as TableRecord[];\n    res.status(200).json({ success: true, data: records });\n  } catch (error) {\n    Sentry.captureException({ error: 'Error fetching table records' });\n    console.error('Error fetching table records:', error);\n    res.status(500).json({\n      success: false,\n      message: 'Error fetching records from table',\n      data: error,\n    });\n  }\n};\n\nlet dbPassword = process.env.DB_PASSWORD; // default to env var for backward compatibility\n// if docker secret file is provided, read the password from there\nif (process.env.SQL_SERVER_PASSWORD_FILE) {\n  try {\n    dbPassword = fs\n      .readFileSync(process.env.SQL_SERVER_PASSWORD_FILE, 'utf-8')\n      .trim();\n  } catch (e) {\n    console.error('Error reading dbPassword from file:', e);\n  }\n}\n\nconst dbConfig: sql.config = {\n  user: process.env.DB_USER,\n  password: dbPassword,\n  database: process.env.DB_NAME,\n  server: process.env.DB_HOST || 'localhost',\n  options: {\n    trustServerCertificate: true,\n  },\n};\n\n// -------------------------------------\n// 2) Data Interfaces\n// -------------------------------------\ninterface Requirement {\n  poolId: string; // e.g., \"engineering-core\"\n  poolName: string; // e.g., \"Engineering Core (30.5 credits)\"\n  creditsRequired: number; // e.g., 30.5\n  courseCodes: string[]; // e.g., [\"ELEC275\", \"ENCS282\", ...]\n}\n\ninterface DegreeData {\n  degreeId: string;\n  degreeName: string;\n  totalCredits: number;\n  requirements: Requirement[];\n  isAddon: boolean;\n}\n\n// Requisite Interface\ninterface Requisite {\n  code1: string; // Course code that has the requisite\n  code2?: string; // Prerequisite course code (optional for credit-based)\n  type: 'pre' | 'co';\n  groupId?: string; // Identifier for groups of alternative requisites\n  creditsRequired?: number; // Number of credits required (optional for credit-based)\n}\n\n// CourseJson Interface\ninterface CourseJson {\n  title: string; // e.g., \"ENGR 201 Professional Practice and Responsibility (1.5 credits)\"\n  credits?: number; // e.g., 1.5\n  description?: string;\n  prerequisites?: string; // e.g., \"COMP 248, MATH 201\" or \"COMP 248/MATH 201\"\n  corequisites?: string; // e.g., \"MATH 203\" or \"MATH 203/ENGR 300\"\n  offeredIn?: string[]; // e.g., [\"Fall\", \"Winter\"]\n  // ... more if needed\n}\n\n// -------------------------------------\n// 3) Parse the Requirements Text File\n// -------------------------------------\n/**\n * Parses a plaintext degree requirements file into a structured object.\n * and returns a full DegreeData object with requirements array\n */\nfunction parseRequirementsFile(filePath: string): DegreeData {\n  const text = fs.readFileSync(filePath, 'utf-8');\n  const lines = text.split('\\n').map((l) => l.trim());\n\n  let degreeId = '';\n  let degreeName = '';\n  let totalCredits = 120;\n  let isAddon = false;\n  const requirements: Requirement[] = [];\n  let currentPoolName = '';\n  let currentCredits = 0;\n  let currentCourseCodes: string[] = [];\n\n  function pushCurrentPool() {\n    if (currentPoolName) {\n      // Prefix poolName with degreeId to ensure uniqueness\n      const uniquePoolName = `${degreeId} - ${currentPoolName}`;\n      requirements.push({\n        poolId: uniquePoolName\n          .toLowerCase()\n          .replace(/[^a-z0-9]+/g, '-')\n          .replace(/-credits/g, ''),\n        poolName: uniquePoolName,\n        creditsRequired: currentCredits,\n        courseCodes: currentCourseCodes.filter((cc) => cc),\n      });\n    }\n  }\n\n  for (const line of lines) {\n    if (!line || line.startsWith('#')) continue;\n    if (line.includes('DegreeID=')) {\n      degreeId = line.split('=')[1].trim();\n      continue;\n    }\n    if (line.includes('DegreeName=')) {\n      degreeName = line.split('=')[1].trim();\n      continue;\n    }\n    if (line.includes('TotalCredits=')) {\n      totalCredits = parseFloat(line.split('=')[1].trim());\n      continue;\n    }\n    if (line.includes('Addon')) {\n      isAddon = true;\n      continue;\n    }\n    const bracketMatch = line.match(/^\\[(.*)\\]$/);\n    if (bracketMatch) {\n      pushCurrentPool();\n      currentPoolName = bracketMatch[1];\n      currentCourseCodes = [];\n      const creditsMatch = currentPoolName.match(/\\(([\\d]+)\\s*credits?\\)/i);\n      currentCredits = creditsMatch ? parseFloat(creditsMatch[1]) : 0;\n      continue;\n    }\n    currentCourseCodes.push(line);\n  }\n  pushCurrentPool();\n  return { degreeId, degreeName, totalCredits, requirements, isAddon };\n}\n\n// -------------------------------------\n// 4) Parse the JSON (Course Data)\n// -------------------------------------\n/**\n * Loads every course JSON file in the given directory (recursively)\n * and warns if duplicates are found\n */\nfunction loadAllCourseJsons(dirPath: string): Map<string, CourseJson> {\n  const courseMap = new Map<string, CourseJson>();\n  function recurseDirectory(currentPath: string) {\n    const entries = fs.readdirSync(currentPath, { withFileTypes: true });\n    for (const entry of entries) {\n      const fullPath = path.join(currentPath, entry.name);\n      if (entry.isDirectory()) {\n        recurseDirectory(fullPath);\n      } else if (entry.isFile() && entry.name.toLowerCase().endsWith('.json')) {\n        try {\n          const raw = fs.readFileSync(fullPath, 'utf-8');\n          const data: CourseJson[] = JSON.parse(raw);\n          for (const c of data) {\n            const code = extractCodeFromTitle(c.title).toUpperCase();\n            if (courseMap.has(code)) {\n              console.warn(\n                `Warning: Duplicate course code \"${code}\" found in file ${fullPath}. Overwriting previous entry.`,\n              );\n            }\n            courseMap.set(code, c);\n          }\n        } catch (err) {\n          Sentry.captureException({\n            error: `Error parsing JSON file: ${fullPath}`,\n          });\n          console.error(`Error parsing JSON file: ${fullPath}`, err);\n        }\n      }\n    }\n  }\n  recurseDirectory(dirPath);\n  return courseMap;\n}\n\nfunction extractCodeFromTitle(title: string): string {\n  const match = title.match(/^([A-Z]{2,4})\\s*(\\d{3})/);\n  if (!match) throw new Error(`Invalid course title format: \"${title}\"`);\n  return `${match[1]}${match[2]}`.toUpperCase();\n}\n\n// this validates loaded courses mainly by format checks on titles\nfunction validateCourseData(courseMap: Map<string, CourseJson>): void {\n  for (const [code, courseData] of courseMap.entries()) {\n    if (!/^[A-Z]{2,4}\\s*\\d{3}/.test(courseData.title)) {\n      console.warn(\n        `Course \"${code}\" has an invalid title format: \"${courseData.title}\"`,\n      );\n    }\n    ['pre', 'co'].forEach((field) => {\n      const requisiteStr = courseData[field as keyof CourseJson];\n      if (requisiteStr && typeof requisiteStr !== 'string') {\n        console.warn(\n          `Course \"${code}\" has a non-string ${field}:`,\n          requisiteStr,\n        );\n      }\n    });\n  }\n}\n\n// -------------------------------------\n// 5) Upsert Helpers (SQL Statements)\n// -------------------------------------\n/**\n * basically insert rows if they dont exist, or update them if they do.\n * this have been used  for:\n *   - Degrees\n *   - CoursePools\n *   - Courses\n *   - DegreeXCoursePool\n *   - CourseXCoursePool\n *   - Requisites\n */\n\n// they use this to generate the next incremental ID for a table using a prefix.\nasync function generateNextId(\n  t: sql.Transaction,\n  tableName: string,\n  prefix: string,\n): Promise<string> {\n  const request = new sql.Request(t);\n  const query = `\n    SELECT MAX(CAST(SUBSTRING(id, LEN(@prefix) + 1, LEN(id)) AS INT)) AS MaxId\n    FROM [${tableName}]\n    WHERE id LIKE @prefix + '%'\n  `;\n  request.input('prefix', sql.VarChar, prefix);\n  const result = await request.query(query);\n  const maxId = result.recordset[0].MaxId;\n  const nextIdNumber = (maxId !== null ? maxId : 0) + 1;\n  return `${prefix}${nextIdNumber}`;\n}\n\nasync function upsertDegree(\n  t: sql.Transaction,\n  id: string,\n  name: string,\n  totalCredits: number,\n  isAddon: boolean,\n): Promise<string> {\n  const request = new sql.Request(t);\n  request.input('id', sql.VarChar, id);\n  request.input('name', sql.VarChar, name);\n  request.input('totalCredits', sql.Float, totalCredits);\n  request.input('isAddon', sql.Bit, isAddon);\n\n  const result = await request.query('SELECT id FROM Degree WHERE id = @id');\n  if (result.recordset.length === 0) {\n    // Insert a new degree with the provided ID\n    await request.query(`\n      INSERT INTO Degree (id, name, totalCredits, isAddon)\n      VALUES (@id, @name, @totalCredits, @isAddon)\n    `);\n    console.log(`Inserted Degree: ${name} with ID: ${id}`);\n    return id;\n  } else {\n    // Update the existing degree\n    await request.query(`\n      UPDATE Degree\n      SET name = @name, totalCredits = @totalCredits, isAddon = @isAddon\n      WHERE id = @id\n    `);\n    console.log(`Updated Degree: ${name} with ID: ${id}`);\n    return id;\n  }\n}\n\nasync function upsertCoursePool(\n  t: sql.Transaction,\n  poolName: string,\n): Promise<string> {\n  const request = new sql.Request(t);\n  request.input('name', sql.VarChar, poolName);\n  const result = await request.query(\n    'SELECT id FROM CoursePool WHERE name = @name',\n  );\n  if (result.recordset.length === 0) {\n    const newId = await generateNextId(t, 'CoursePool', 'CP');\n    request.input('newId', sql.VarChar, newId);\n    await request.query(`\n      INSERT INTO CoursePool (id, name)\n      VALUES (@newId, @name)\n    `);\n    console.log(`Inserted CoursePool: ${poolName} with ID: ${newId}`);\n    return newId;\n  } else {\n    const poolId = result.recordset[0].id;\n    console.log(`CoursePool already exists: ${poolName} with ID: ${poolId}`);\n    return poolId;\n  }\n}\n\nasync function upsertCourse(\n  t: sql.Transaction,\n  code: string,\n  title: string,\n  credits: number,\n  description: string,\n  offeredIn: string,\n): Promise<void> {\n  const request = new sql.Request(t);\n  request.input('code', sql.VarChar, code);\n  request.input('title', sql.VarChar, title);\n  request.input('credits', sql.Float, credits);\n  request.input('description', sql.VarChar, description);\n  request.input('offeredIn', sql.VarChar, offeredIn);\n  const result = await request.query(\n    'SELECT code FROM Course WHERE code = @code',\n  );\n  if (result.recordset.length === 0) {\n    await request.query(`\n      INSERT INTO Course (code, title, credits, description, offeredIn)\n      VALUES (@code, @title, @credits, @description, @offeredIn)\n    `);\n    console.log(`Inserted Course: ${code}`);\n  } else {\n    await request.query(`\n      UPDATE Course\n      SET title = @title, credits = @credits, description = @description, offeredIn = @offeredIn\n      WHERE code = @code\n    `);\n    console.log(`Updated Course: ${code}`);\n  }\n}\n\nasync function upsertDegreeXCoursePool(\n  t: sql.Transaction,\n  degreeId: string,\n  poolId: string,\n  creditsRequired: number,\n): Promise<string> {\n  const request = new sql.Request(t);\n  request.input('degreeId', sql.VarChar, degreeId);\n  request.input('poolId', sql.VarChar, poolId);\n  request.input('creditsRequired', sql.Float, creditsRequired);\n  const result = await request.query(`\n    SELECT id FROM DegreeXCoursePool\n    WHERE degree = @degreeId AND coursepool = @poolId\n  `);\n  if (result.recordset.length === 0) {\n    const newId = await generateNextId(t, 'DegreeXCoursePool', 'DXCP');\n    request.input('newId', sql.VarChar, newId);\n    await request.query(`\n      INSERT INTO DegreeXCoursePool (id, degree, coursepool, creditsRequired)\n      VALUES (@newId, @degreeId, @poolId, @creditsRequired)\n    `);\n    console.log(`Inserted DegreeXCoursePool with ID: ${newId}`);\n    return newId;\n  } else {\n    const dxcpId = result.recordset[0].id;\n    request.input('id', sql.VarChar, dxcpId);\n    await request.query(`\n      UPDATE DegreeXCoursePool\n      SET creditsRequired = @creditsRequired\n      WHERE id = @id\n    `);\n    console.log(`Updated DegreeXCoursePool with ID: ${dxcpId}`);\n    return dxcpId;\n  }\n}\n\nasync function upsertCourseXCoursePool(\n  t: sql.Transaction,\n  courseCode: string,\n  poolId: string,\n  groupId: string | null,\n): Promise<string> {\n  const request = new sql.Request(t);\n  request.input('courseCode', sql.VarChar, courseCode);\n  request.input('poolId', sql.VarChar, poolId);\n  request.input('groupId', sql.VarChar, groupId);\n  const result = await request.query(`\n    SELECT id FROM CourseXCoursePool\n    WHERE coursecode = @courseCode AND coursepool = @poolId AND \n          ((@groupId IS NULL AND groupId IS NULL) OR groupId = @groupId)\n  `);\n  if (result.recordset.length === 0) {\n    const newId = await generateNextId(t, 'CourseXCoursePool', 'CXP');\n    request.input('newId', sql.VarChar, newId);\n    await request.query(`\n      INSERT INTO CourseXCoursePool (id, coursecode, coursepool, groupId)\n      VALUES (@newId, @courseCode, @poolId, @groupId)\n    `);\n    console.log(\n      `Linked Course ${courseCode} to CoursePool ID: ${poolId}` +\n        (groupId ? ` with groupId: ${groupId}` : ''),\n    );\n    return newId;\n  } else {\n    const cxcpId = result.recordset[0].id;\n    console.log(\n      `CourseXCoursePool already exists for Course ${courseCode} in Pool ID: ${poolId}` +\n        (groupId ? ` with groupId: ${groupId}` : ''),\n    );\n    return cxcpId;\n  }\n}\n\nasync function upsertRequisite(\n  t: sql.Transaction,\n  requisite: Requisite,\n): Promise<void> {\n  const { code1, code2, type, groupId, creditsRequired } = requisite;\n  const request = new sql.Request(t);\n  request.input('code1', sql.VarChar, code1);\n  request.input('type', sql.VarChar, type);\n  if (creditsRequired !== undefined) {\n    request.input('creditsRequired', sql.Float, creditsRequired);\n  }\n  if (code2) {\n    request.input('code2', sql.VarChar, code2);\n  }\n  if (groupId) {\n    request.input('group_id', sql.VarChar, groupId);\n  }\n  let whereClause = 'code1 = @code1 AND type = @type';\n  if (creditsRequired !== undefined) {\n    whereClause +=\n      ' AND creditsRequired = @creditsRequired AND code2 IS NULL AND group_id IS NULL';\n  } else if (code2) {\n    whereClause += ' AND code2 = @code2';\n    if (groupId) {\n      whereClause += ' AND group_id = @group_id';\n    } else {\n      whereClause += ' AND group_id IS NULL';\n    }\n  }\n  const result = await request.query(\n    `SELECT id FROM Requisite WHERE ${whereClause}`,\n  );\n  if (result.recordset.length === 0) {\n    const newId = await generateNextId(t, 'Requisite', 'R');\n    request.input('newId', sql.VarChar, newId);\n    await request.query(`\n      INSERT INTO Requisite (id, code1, code2, type, group_id, creditsRequired)\n      VALUES (\n        @newId, \n        @code1, \n        ${creditsRequired !== undefined ? 'NULL' : code2 ? '@code2' : 'NULL'}, \n        @type, \n        ${\n          creditsRequired !== undefined\n            ? 'NULL'\n            : groupId\n              ? '@group_id'\n              : 'NULL'\n        }, \n        ${creditsRequired !== undefined ? '@creditsRequired' : 'NULL'}\n      )\n    `);\n    console.log(\n      `Inserted Requisite: ${code1}` +\n        (code2\n          ? ` -> ${code2}`\n          : ` with Credits Required: ${creditsRequired}`) +\n        ` (${type})` +\n        (groupId ? ` Group ID: ${groupId}` : ''),\n    );\n  } else {\n    console.log(\n      `Requisite already exists: ${code1}` +\n        (code2\n          ? ` -> ${code2}`\n          : ` with Credits Required: ${creditsRequired}`) +\n        ` (${type})` +\n        (groupId ? ` Group ID: ${groupId}` : ''),\n    );\n  }\n}\n\nasync function getPoolIdByName(\n  t: sql.Transaction,\n  poolName: string,\n): Promise<string> {\n  const request = new sql.Request(t);\n  request.input('name', sql.VarChar, poolName);\n  const result = await request.query(\n    'SELECT id FROM CoursePool WHERE name = @name',\n  );\n  if (result.recordset.length === 0) {\n    throw new Error(`CoursePool with name \"${poolName}\" does not exist.`);\n  }\n  return result.recordset[0].id;\n}\n\nfunction generateGroupId(\n  degreeId: string,\n  poolId: string,\n  groupNumber: number,\n): string {\n  return `${degreeId}-${poolId}-G${groupNumber}`;\n}\n\n// -------------------------------------\n// 5) Parse Requisites Function\n// -------------------------------------\nlet globalGroupCounter = 1;\nfunction parseRequisites(\n  code1: string,\n  requisiteStr: string | undefined,\n  type: 'pre' | 'co',\n): Requisite[] {\n  if (!requisiteStr) return [];\n  if (typeof requisiteStr !== 'string') {\n    console.warn(\n      `Expected string for requisites but got ${typeof requisiteStr} for course ${code1}. Skipping.`,\n    );\n    return [];\n  }\n  const cleanedStr = requisiteStr.replace(/[;]/g, ',');\n  const parts = cleanedStr\n    .split(',')\n    .map((part) => part.trim())\n    .filter(Boolean);\n  const requisites: Requisite[] = [];\n  for (const part of parts) {\n    if (part.includes('/')) {\n      const alternatives = part.split('/').map((c) => c.trim());\n      const groupId = `G${globalGroupCounter++}`;\n      for (const alt of alternatives) {\n        const code = alt.replace(/\\s+/g, '').toUpperCase();\n        if (/^[A-Z]{2,4}\\d{3}$/.test(code)) {\n          requisites.push({ code1, code2: code, type, groupId });\n        } else if (/^\\d+CR$/i.test(code)) {\n          requisites.push({\n            code1,\n            creditsRequired: parseFloat(code.replace(/CR/i, '')),\n            type,\n            groupId,\n          });\n        } else {\n          console.warn(\n            `Invalid course code or credit requirement \"${code}\" in requisites for course \"${code1}\". Skipping.`,\n          );\n        }\n      }\n    } else {\n      const code = part.replace(/\\s+/g, '').toUpperCase();\n      if (/^[A-Z]{2,4}\\d{3}$/.test(code)) {\n        requisites.push({ code1, code2: code, type });\n      } else if (/^\\d+CR$/i.test(code)) {\n        requisites.push({\n          code1,\n          creditsRequired: parseFloat(code.replace(/CR/i, '')),\n          type,\n        });\n      } else {\n        console.warn(\n          `Invalid course code or credit requirement \"${code}\" in requisites for course \"${code1}\". Skipping.`,\n        );\n      }\n    }\n  }\n  return requisites;\n}\n\n// -------------------------------------\n// 6) Main Seed Function\n// -------------------------------------\n/**\n * main seeding function that\n * basically brings the DB up to date with whats in course-data/.\n */\nasync function seedSoenDegree() {\n  let transaction: sql.Transaction | null = null;\n  let pool: sql.ConnectionPool | null = null;\n  try {\n    // 1. DEFINE PATHS\n    const requirementsDir = path.join(\n      __dirname,\n      '../../course-data/degree-reqs',\n    );\n    const courseListsDir = path.join(\n      __dirname,\n      '../../course-data/course-lists/updated_courses',\n    );\n\n    // 2. READ ALL REQUIREMENT FILES\n    const files = await readdir(requirementsDir);\n    const requirementFiles = files.filter((file) => file.endsWith('.txt'));\n    if (requirementFiles.length === 0) {\n      console.warn('No requirement files found in the directory.');\n      return;\n    }\n\n    // 3. LOAD ALL COURSE JSONS and VALIDATE\n    const courseMap = loadAllCourseJsons(courseListsDir);\n    validateCourseData(courseMap);\n\n    // 5. CONNECT TO DATABASE\n    console.log('[SEED] Connecting to DB...');\n    pool = await sql.connect(dbConfig);\n    const dbResult = await pool.request().query('SELECT DB_NAME() AS dbName');\n    const connectedDbName = dbResult.recordset[0].dbName;\n    console.log(`[SEED] Connected to database: ${connectedDbName}`);\n    if (connectedDbName !== process.env.DB_NAME) {\n      throw new Error(\n        `Connected to incorrect database \"${connectedDbName}\". Expected \"${process.env.DB_NAME}\".`,\n      );\n    }\n\n    // Phase 1: Upsert Courses and Requisites (only once)\n    try {\n      transaction = pool.transaction();\n      await transaction.begin();\n      // Upsert Courses\n      for (const [code, courseData] of courseMap.entries()) {\n        const cTitle = courseData.title;\n        const cCredits = courseData.credits ?? 3;\n        const cDesc = courseData.description ?? `No description for ${code}`;\n        const cOfferedIn = courseData.offeredIn?.join(', ') ?? 'Empty';\n        await upsertCourse(\n          transaction,\n          code,\n          cTitle,\n          cCredits,\n          cDesc,\n          cOfferedIn,\n        );\n      }\n      // Upsert Requisites (Prerequisites and Corequisites)\n      for (const [code, courseData] of courseMap.entries()) {\n        const prerequisites = parseRequisites(\n          code,\n          courseData.prerequisites,\n          'pre',\n        );\n        for (const preReq of prerequisites) {\n          if (\n            preReq.code2 &&\n            !courseMap.has(preReq.code2) &&\n            !/^\\d+CR$/.test(preReq.code2)\n          ) {\n            console.warn(\n              `Prerequisite course or credit requirement \"${preReq.code2}\" for \"${code}\" does not exist. Skipping.`,\n            );\n            continue;\n          }\n          await upsertRequisite(transaction, preReq);\n        }\n        const corequisites = parseRequisites(\n          code,\n          courseData.corequisites,\n          'co',\n        );\n        for (const coReq of corequisites) {\n          if (\n            coReq.code2 &&\n            !courseMap.has(coReq.code2) &&\n            !/^\\d+CR$/.test(coReq.code2)\n          ) {\n            console.warn(\n              `Corequisite course or credit requirement \"${coReq.code2}\" for \"${code}\" does not exist. Skipping.`,\n            );\n            continue;\n          }\n          await upsertRequisite(transaction, coReq);\n        }\n      }\n      await transaction.commit();\n      console.log('Courses and requisites upserted successfully.');\n    } catch (err) {\n      console.error('Error upserting courses and requisites:', err);\n      // Attempt rollback if possible\n      try {\n        if (transaction) await transaction.rollback();\n      } catch (rollbackErr) {\n        console.error('Error during rollback:', rollbackErr);\n      }\n      throw err;\n    }\n\n    // Phase 2: Process each requirement file for degree-specific linking\n    for (const file of requirementFiles) {\n      const filePath = path.join(requirementsDir, file);\n      console.log(`[SEED] Processing file: ${filePath}`);\n      const { degreeId, degreeName, totalCredits, requirements, isAddon } =\n        parseRequirementsFile(filePath);\n      const tx = pool.transaction();\n      await tx.begin();\n      console.log(`[SEED] Transaction started for degree: ${degreeName}`);\n      try {\n        // Upsert Degree\n        const degreeIdNumber = await upsertDegree(\n          tx,\n          degreeId,\n          degreeName,\n          totalCredits,\n          isAddon,\n        );\n        // Upsert Course Pools and DegreeXCoursePool\n        for (const req of requirements) {\n          const uniquePoolName = req.poolName; // Already includes the degreeId prefix\n          const poolIdNumber = await upsertCoursePool(tx, uniquePoolName);\n          await upsertDegreeXCoursePool(\n            tx,\n            degreeIdNumber,\n            poolIdNumber,\n            req.creditsRequired,\n          );\n        }\n        // Link Courses to Course Pools\n        for (const req of requirements) {\n          // Handle Course Groups (Alternative Courses)\n          const alternativeCourses = req.courseCodes.filter(\n            (code) => code.includes(',') || code.includes('/'),\n          );\n          let groupNumber = 1;\n          for (const altLine of alternativeCourses) {\n            const separators = altLine.includes('/') ? '/' : ',';\n            const groupCourses = altLine.split(separators).map((c) => c.trim());\n            if (groupCourses.length > 1) {\n              const groupId = generateGroupId(\n                degreeId,\n                req.poolId,\n                groupNumber,\n              );\n              for (const courseCode of groupCourses) {\n                const upperCode = courseCode.toUpperCase().replace(/\\s+/g, '');\n                const isCreditReq = /^\\d+CR$/.test(upperCode);\n                if (!/^[A-Z]{2,4}\\d{3}$/.test(upperCode) && !isCreditReq) {\n                  console.log(\n                    `Skipping invalid course code or credit requirement: \"${courseCode}\"`,\n                  );\n                  continue;\n                }\n                const poolIdNumber = await getPoolIdByName(tx, req.poolName);\n                console.log(\n                  `Upserting ${upperCode} in ${req.poolName} with groupId ${groupId}`,\n                );\n                if (isCreditReq) {\n                  console.warn(\n                    `Credit-based requisites should be handled in course prerequisites. Skipping linking for \"${upperCode}\".`,\n                  );\n                } else {\n                  await upsertCourseXCoursePool(\n                    tx,\n                    upperCode,\n                    poolIdNumber,\n                    groupId,\n                  );\n                }\n              }\n              groupNumber++;\n            } else {\n              const code = groupCourses[0];\n              const upperCode = code.toUpperCase().replace(/\\s+/g, '');\n              const isCreditReq = /^\\d+CR$/.test(upperCode);\n              if (!/^[A-Z]{2,4}\\d{3}$/.test(upperCode) && !isCreditReq) {\n                console.log(\n                  `Skipping invalid course code or credit requirement: \"${code}\"`,\n                );\n                continue;\n              }\n              const poolIdNumber = await getPoolIdByName(tx, req.poolName);\n              console.log(`Upserting ${upperCode} in ${req.poolName}`);\n              if (isCreditReq) {\n                console.warn(\n                  `Credit-based requisites should be handled in course prerequisites. Skipping linking for \"${upperCode}\".`,\n                );\n              } else {\n                await upsertCourseXCoursePool(\n                  tx,\n                  upperCode,\n                  poolIdNumber,\n                  null,\n                );\n              }\n            }\n          }\n          // Handle Non-Alternative Courses\n          const nonAlternativeCourses = req.courseCodes.filter(\n            (code) => !code.includes(',') && !code.includes('/'),\n          );\n          for (const code of nonAlternativeCourses) {\n            const upperCode = code.toUpperCase().replace(/\\s+/g, '');\n            const isCreditReq = /^\\d+CR$/.test(upperCode);\n            if (!/^[A-Z]{2,4}\\d{3}$/.test(upperCode) && !isCreditReq) {\n              console.log(\n                `Skipping invalid course code or credit requirement: \"${code}\"`,\n              );\n              continue;\n            }\n            const poolIdNumber = await getPoolIdByName(tx, req.poolName);\n            console.log(`Upserting ${upperCode} in ${req.poolName}`);\n            if (isCreditReq) {\n              console.warn(\n                `Credit-based requisites should be handled in course prerequisites. Skipping linking for \"${upperCode}\".`,\n              );\n            } else {\n              await upsertCourseXCoursePool(tx, upperCode, poolIdNumber, null);\n            }\n          }\n        }\n        await tx.commit();\n        console.log(\n          `[SEED] Seeding completed successfully for degree: ${degreeName}`,\n        );\n      } catch (err) {\n        console.error(\n          `[SEED] Error during seeding degree \"${degreeName}\":`,\n          err,\n        );\n        try {\n          await tx.rollback();\n          console.log(\n            `[SEED] Transaction rolled back for degree: ${degreeName}`,\n          );\n        } catch (rollbackErr) {\n          console.error(\n            `[SEED] Error during rollback for degree \"${degreeName}\":`,\n            rollbackErr,\n          );\n        }\n        continue;\n      }\n    }\n\n    console.log('[SEED] All requirement files have been processed.');\n    await pool.close();\n  } catch (err) {\n    console.error('[SEED] Unexpected error during seeding:', err);\n    if (pool) {\n      try {\n        await pool.close();\n      } catch (closeErr) {\n        console.error(\n          '[SEED] Error closing the database connection:',\n          closeErr,\n        );\n      }\n    }\n  }\n}\n\n// If running from command line: `ts-node adminController.ts`\nif (require.main === module) {\n  seedSoenDegree();\n}\n\nexport { seedSoenDegree };\n"]}