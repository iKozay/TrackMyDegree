{"version":3,"file":"coursepoolController.js","sourceRoot":"","sources":["../../../controllers/coursepoolController/coursepoolController.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Purpose:\n *  - Controller for managing CoursePool entities (create, read, update, delete).\n *  - Encapsulates all DB operations tied to course pools.\n * Notes:\n *  - Returns DB_OPS enum to standardize operation results (SUCCESS, FAILURE, etc.)\n *  - Relies on DBController for SQL Server connections.\n *  - Errors logged locally and reported to Sentry.\n *  - Uses coursepool_types.d.ts for strong typing of course pool objects.\n */\n\nimport Database from '@controllers/DBController/DBController';\nimport DB_OPS from '@Util/DB_Ops';\nimport CoursePoolTypes from '@controllers/coursepoolController/coursepool_types';\nimport { randomUUID } from 'crypto';\nimport * as Sentry from '@sentry/node';\n\nconst log = console.log;\n\n/**\n * Creates a new course pool.\n *\n * @param {string} pool_name - The name of the course pool.\n * @returns {Promise<DB_OPS>} - Returns a DB operation status.\n */\nasync function createCoursePool(pool_name: string): Promise<DB_OPS> {\n  const dbConn = await Database.getConnection();\n\n  if (dbConn) {\n    let record: CoursePoolTypes.CoursePoolItem = {\n      id: randomUUID(),\n      name: pool_name,\n    };\n\n    try {\n      const result = await dbConn\n        .request()\n        .input('id', Database.msSQL.VarChar, record.id)\n        .input('name', Database.msSQL.VarChar, record.name)\n        .query(\n          'INSERT INTO CoursePool ( id, name )\\\n              OUTPUT INSERTED.id\\\n              VALUES                 (@id, @name)',\n        );\n      // INSERT uses OUTPUT INSERTED.id so we expect result.recordset to contain the inserted id.\n      // If result.recordset is undefined the code treats it as a partial success (MOSTLY_OK).\n      // This is how almost all the MOSTLY_OK returns behave in this file and other controllers till now.\n\n      if (undefined === result.recordset) {\n        log('Error inserting coursepool record: ' + result.recordset);\n        return DB_OPS.MOSTLY_OK;\n      } else {\n        return DB_OPS.SUCCESS;\n      }\n    } catch (error) {\n      Sentry.captureException({ error: 'Error in coursepool creation' });\n      log('Error in coursepool creation\\n', error);\n    }\n  }\n\n  return DB_OPS.FAILURE;\n}\n\n/**\n * Retrieves all course pools.\n *\n * @returns {Promise<{ course_pools: CoursePoolTypes.CoursePoolItem[] } | undefined>}\n */\nasync function getAllCoursePools(): Promise<\n  { course_pools: CoursePoolTypes.CoursePoolItem[] } | undefined\n> {\n  const dbConn = await Database.getConnection();\n\n  if (dbConn) {\n    try {\n      const result = await dbConn.request().query('SELECT * FROM CoursePool');\n      // returns empty array of table is empty\n      return {\n        course_pools: result.recordset,\n      };\n    } catch (error) {\n      Sentry.captureException({\n        error: 'Error fetching all course pools',\n      });\n      log('Error fetching all course pools\\n', error);\n    }\n  }\n\n  return undefined;\n}\n\n/**\n * Retrieves a specific course pool by ID.\n *\n * @param {string} pool_id - The course pool ID.\n * @returns {Promise<CoursePoolTypes.CoursePoolItem | undefined>}\n */\nasync function getCoursePool(\n  pool_id: string,\n): Promise<CoursePoolTypes.CoursePoolItem | undefined> {\n  const dbConn = await Database.getConnection();\n\n  if (dbConn) {\n    try {\n      const result = await dbConn\n        .request()\n        .input('id', Database.msSQL.VarChar, pool_id)\n        .query(\n          'SELECT * FROM CoursePool\\\n              WHERE id = @id',\n        );\n\n      return result.recordset[0];\n    } catch (error) {\n      Sentry.captureException({\n        error: 'Error fetching course pool by ID',\n      });\n      log('Error fetching course pool by ID\\n', error);\n    }\n  }\n\n  return undefined;\n}\n\n/**\n * Updates an existing course pool.\n *\n * @param {CoursePoolTypes.CoursePoolItem} update_info - The course pool details to update.\n * @returns {Promise<DB_OPS>}\n */\nasync function updateCoursePool(\n  update_info: CoursePoolTypes.CoursePoolItem,\n): Promise<DB_OPS> {\n  const dbConn = await Database.getConnection();\n\n  if (dbConn) {\n    const { id, name } = update_info;\n\n    try {\n      const result = await dbConn\n        .request()\n        .input('id', Database.msSQL.VarChar, id)\n        .input('name', Database.msSQL.VarChar, name)\n        .query(\n          'UPDATE CoursePool  \\\n              SET   name = @name \\\n              OUTPUT INSERTED.id \\\n              WHERE   id = @id',\n        );\n\n      if (result.recordset.length > 0 && id === result.recordset[0].id) {\n        return DB_OPS.SUCCESS;\n      } else {\n        return DB_OPS.MOSTLY_OK;\n      }\n    } catch (error) {\n      Sentry.captureException({\n        error: 'Error in updating course pool item',\n      });\n      log('Error in updating course pool item\\n', error);\n    }\n  }\n\n  return DB_OPS.FAILURE;\n}\n\n/**\n * Removes a course pool by ID.\n *\n * @param {string} pool_id - The course pool ID to remove.\n * @returns {Promise<DB_OPS>}\n */\nasync function removeCoursePool(pool_id: string): Promise<DB_OPS> {\n  const dbConn = await Database.getConnection();\n\n  if (dbConn) {\n    try {\n      const result = await dbConn\n        .request()\n        .input('id', Database.msSQL.VarChar, pool_id)\n        .query(\n          'DELETE FROM CoursePool\\\n                  OUTPUT DELETED.id\\\n                  WHERE id = @id',\n        );\n\n      if (result.recordset.length > 0 && result.recordset[0].id === pool_id) {\n        return DB_OPS.SUCCESS;\n      } else {\n        return DB_OPS.MOSTLY_OK;\n      }\n    } catch (error) {\n      Sentry.captureException({\n        error: 'Error in deleting course pool item',\n      });\n      log('Error in deleting course pool item\\n', error);\n    }\n  }\n\n  return DB_OPS.FAILURE;\n}\n\nconst coursepoolController = {\n  createCoursePool,\n  getAllCoursePools,\n  getCoursePool,\n  updateCoursePool,\n  removeCoursePool,\n};\n\nexport default coursepoolController;\n"]}